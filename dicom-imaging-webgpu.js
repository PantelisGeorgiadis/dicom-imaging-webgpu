!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).dicomImagingWebGpu={})}(this,function(e){"use strict";function t(e,t,r,a,n,i,o){try{var s=e[i](o),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(a,n)}function r(e){return function(){var r=this,a=arguments;return new Promise(function(n,i){var o=e.apply(r,a);function s(e){t(o,n,i,s,l,"next",e)}function l(e){t(o,n,i,s,l,"throw",e)}s(void 0)})}}function a(e,t,r){return t=l(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,f()?Reflect.construct(t,r||[],l(e).constructor):t.apply(e,r))}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,g(a.key),a)}}function o(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e,t,r){return(t=g(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function l(e){return l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},l(e)}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&p(e,t)}function f(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(f=function(){return!!e})()}function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,a)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach(function(t){s(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function h(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */
var e,t,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",n=r.toStringTag||"@@toStringTag";function i(r,a,n,i){var l=a&&a.prototype instanceof s?a:s,d=Object.create(l.prototype);return m(d,"_invoke",function(r,a,n){var i,s,l,d=0,f=n||[],c=!1,u={p:0,n:0,v:e,a:h,f:h.bind(e,4),d:function(t,r){return i=t,s=0,l=e,u.n=r,o}};function h(r,a){for(s=r,l=a,t=0;!c&&d&&!n&&t<f.length;t++){var n,i=f[t],h=u.p,m=i[2];r>3?(n=m===a)&&(l=i[(s=i[4])?5:(s=3,3)],i[4]=i[5]=e):i[0]<=h&&((n=r<2&&h<i[1])?(s=0,u.v=a,u.n=i[1]):h<m&&(n=r<3||i[0]>a||a>m)&&(i[4]=r,i[5]=a,u.n=m,s=0))}if(n||r>1)return o;throw c=!0,a}return function(n,f,m){if(d>1)throw TypeError("Generator is already running");for(c&&1===f&&h(f,m),s=f,l=m;(t=s<2?e:l)||!c;){i||(s?s<3?(s>1&&(u.n=-1),h(s,l)):u.n=l:u.v=l);try{if(d=2,i){if(s||(n="next"),t=i[n]){if(!(t=t.call(i,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,s<2&&(s=0)}else 1===s&&(t=i.return)&&t.call(i),s<2&&(l=TypeError("The iterator does not provide a '"+n+"' method"),s=1);i=e}else if((t=(c=u.n<0)?l:r.call(a,u))!==o)break}catch(t){i=e,s=1,l=t}finally{d=1}}return{value:t,done:c}}}(r,n,i),!0),d}var o={};function s(){}function l(){}function d(){}t=Object.getPrototypeOf;var f=[][a]?t(t([][a]())):(m(t={},a,function(){return this}),t),c=d.prototype=s.prototype=Object.create(f);function u(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,m(e,n,"GeneratorFunction")),e.prototype=Object.create(c),e}return l.prototype=d,m(c,"constructor",d),m(d,"constructor",l),l.displayName="GeneratorFunction",m(d,n,"GeneratorFunction"),m(c),m(c,n,"Generator"),m(c,a,function(){return this}),m(c,"toString",function(){return"[object Generator]"}),(h=function(){return{w:i,m:u}})()}function m(e,t,r,a){var n=Object.defineProperty;try{n({},"",{})}catch(e){n=0}m=function(e,t,r,a){function i(t,r){m(e,t,function(e){return this._invoke(t,r,e)})}t?n?n(e,t,{value:r,enumerable:!a,configurable:!a,writable:!a}):e[t]=r:(i("next",0),i("throw",1),i("return",2))},m(e,t,r,a)}function p(e,t){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},p(e,t)}function g(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t);if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}function _(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function w(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var t=e.default;if("function"==typeof t){var r=function e(){var r=!1;try{r=this instanceof e}catch{}return r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(t){var a=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,a.get?a:{enumerable:!0,get:function(){return e[t]}})}),r}var b,y={exports:{}},v=w(Object.freeze({__proto__:null,default:{}}));var x=(b||(b=1,function(e){e.exports=function(e){return r=[function(t,r){t.exports=e},function(e,t,r){r.r(t),r.d(t,"isStringVr",function(){return n}),r.d(t,"isPrivateTag",function(){return i}),r.d(t,"parsePN",function(){return o}),r.d(t,"parseTM",function(){return s}),r.d(t,"parseDA",function(){return d}),r.d(t,"explicitElementToString",function(){return f}),r.d(t,"explicitDataSetToJS",function(){return c}),r.d(t,"createJPEGBasicOffsetTable",function(){return m}),r.d(t,"parseDicomDataSetExplicit",function(){return I}),r.d(t,"parseDicomDataSetImplicit",function(){return F}),r.d(t,"readFixedString",function(){return w}),r.d(t,"alloc",function(){return B}),r.d(t,"version",function(){return T}),r.d(t,"bigEndianByteArrayParser",function(){return R}),r.d(t,"ByteStream",function(){return M}),r.d(t,"sharedCopy",function(){return C}),r.d(t,"DataSet",function(){return v}),r.d(t,"findAndSetUNElementLength",function(){return _}),r.d(t,"findEndOfEncapsulatedElement",function(){return g}),r.d(t,"findItemDelimitationItemAndSetElementLength",function(){return x}),r.d(t,"littleEndianByteArrayParser",function(){return N}),r.d(t,"parseDicom",function(){return q}),r.d(t,"readDicomElementExplicit",function(){return U}),r.d(t,"readDicomElementImplicit",function(){return k}),r.d(t,"readEncapsulatedImageFrame",function(){return W}),r.d(t,"readEncapsulatedPixelData",function(){return V}),r.d(t,"readEncapsulatedPixelDataFromFragments",function(){return H}),r.d(t,"readPart10Header",function(){return Z}),r.d(t,"readSequenceItemsExplicit",function(){return O}),r.d(t,"readSequenceItemsImplicit",function(){return D}),r.d(t,"readSequenceItem",function(){return E}),r.d(t,"readTag",function(){return p});var a={AE:!0,AS:!0,AT:!1,CS:!0,DA:!0,DS:!0,DT:!0,FL:!1,FD:!1,IS:!0,LO:!0,LT:!0,OB:!1,OD:!1,OF:!1,OW:!1,PN:!0,SH:!0,SL:!1,SQ:!1,SS:!1,ST:!0,TM:!0,UI:!0,UL:!1,UN:void 0,UR:!0,US:!1,UT:!0},n=function(e){return a[e]},i=function(e){if(e=parseInt(e[4],16),isNaN(e))throw"dicomParser.isPrivateTag: cannot parse last character of group";return e%2==1},o=function(e){if(void 0!==e)return{familyName:(e=e.split("^"))[0],givenName:e[1],middleName:e[2],prefix:e[3],suffix:e[4]}};function s(e,t){if(2<=e.length){var r=parseInt(e.substring(0,2),10),a=4<=e.length?parseInt(e.substring(2,4),10):void 0,n=6<=e.length?parseInt(e.substring(4,6),10):void 0,i=(i=8<=e.length?e.substring(7,13):void 0)?parseInt(i,10)*Math.pow(10,6-i.length):void 0;if(t&&(isNaN(r)||void 0!==a&&isNaN(a)||void 0!==n&&isNaN(n)||void 0!==i&&isNaN(i)||r<0||23<r||a&&(a<0||59<a)||n&&(n<0||59<n)||i&&(i<0||999999<i)))throw"invalid TM '".concat(e,"'");return{hours:r,minutes:a,seconds:n,fractionalSeconds:i}}if(t)throw"invalid TM '".concat(e,"'")}function l(e,t,r){return!isNaN(r)&&0<t&&t<=12&&0<e&&e<=function(e,t){switch(e){case 2:return t%4==0&&t%100||t%400==0?29:28;case 9:case 4:case 6:case 11:return 30;default:return 31}}(t,r)}function d(e,t){if(e&&8===e.length){var r=parseInt(e.substring(0,4),10),a=parseInt(e.substring(4,6),10),n=parseInt(e.substring(6,8),10);if(t&&!0!==l(n,a,r))throw"invalid DA '".concat(e,"'");return{year:r,month:a,day:n}}if(t)throw"invalid DA '".concat(e,"'")}function f(e,t){if(void 0===e||void 0===t)throw"dicomParser.explicitElementToString: missing required parameters";if(void 0===t.vr)throw"dicomParser.explicitElementToString: cannot convert implicit element to string";var r,a=t.vr,i=t.tag;function o(t,r){for(var a="",n=0;n<t;n++)0!==n&&(a+="/"),a+=r.call(e,i,n).toString();return a}if(!0===n(a))r=e.string(i);else{if("AT"===a){var s=e.uint32(i);return void 0===s?void 0:"x".concat((s=s<0?4294967295+s+1:s).toString(16).toUpperCase())}"US"===a?r=o(t.length/2,e.uint16):"SS"===a?r=o(t.length/2,e.int16):"UL"===a?r=o(t.length/4,e.uint32):"SL"===a?r=o(t.length/4,e.int32):"FD"===a?r=o(t.length/8,e.double):"FL"===a&&(r=o(t.length/4,e.float))}return r}function c(e,t){if(void 0===e)throw"dicomParser.explicitDataSetToJS: missing required parameter dataSet";t=t||{omitPrivateAttibutes:!0,maxElementLength:128};var r,a={};for(r in e.elements){var n=e.elements[r];if(!0!==t.omitPrivateAttibutes||!i(r))if(n.items){for(var o=[],s=0;s<n.items.length;s++)o.push(c(n.items[s].dataSet,t));a[r]=o}else{var l=void 0;n.length<t.maxElementLength&&(l=f(e,n)),a[r]=void 0!==l?l:{dataOffset:n.dataOffset,length:n.length}}}return a}function u(e,t){return 255===e.byteArray[t]&&217===e.byteArray[t+1]}function h(e,t,r){for(var a,n,i=r;i<t.fragments.length;i++)if(n=i,u(a=e,(n=t.fragments[n]).position+n.length-2)||u(a,n.position+n.length-3))return i}function m(e,t,r){if(void 0===e)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter dataSet";if(void 0===t)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter pixelDataElement";if("x7fe00010"!==t.tag)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010'";if(!0!==t.encapsulatedPixelData)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.basicOffsetTable)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.fragments)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(t.fragments.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(r&&r.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'fragments' must not be zero length";r=r||t.fragments;for(var a=[],n=0;;){a.push(t.fragments[n].offset);var i=h(e,t,n);if(void 0===i||i===t.fragments.length-1)return a;n=i+1}}function p(e){if(void 0===e)throw"dicomParser.readTag: missing required parameter 'byteStream'";var t=256*e.readUint16()*256;return e=e.readUint16(),"x".concat("00000000".concat((t+e).toString(16)).substr(-8))}function g(e,t,r){if(void 0===e)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'element'";if(t.encapsulatedPixelData=!0,t.basicOffsetTable=[],t.fragments=[],"xfffee000"!==p(e))throw"dicomParser.findEndOfEncapsulatedElement: basic offset table not found";for(var a=e.readUint32()/4,n=0;n<a;n++){var i=e.readUint32();t.basicOffsetTable.push(i)}for(var o=e.position;e.position<e.byteArray.length;){var s=p(e),l=e.readUint32();if("xfffee0dd"===s)return e.seek(l),void(t.length=e.position-t.dataOffset);if("xfffee000"!==s)return r&&r.push("unexpected tag ".concat(s," while searching for end of pixel data element with undefined length")),l>e.byteArray.length-e.position&&(l=e.byteArray.length-e.position),t.fragments.push({offset:e.position-o-8,position:e.position,length:l}),e.seek(l),void(t.length=e.position-t.dataOffset);t.fragments.push({offset:e.position-o-8,position:e.position,length:l}),e.seek(l)}r&&r.push("pixel data element ".concat(t.tag," missing sequence delimiter tag xfffee0dd"))}function _(e,t){if(void 0===e)throw"dicomParser.findAndSetUNElementLength: missing required parameter 'byteStream'";for(var r=e.byteArray.length-8;e.position<=r;)if(65534===e.readUint16()&&57565===e.readUint16())return 0!==e.readUint32()&&e.warnings("encountered non zero length following item delimiter at position ".concat(e.position-4," while reading element of undefined length with tag ").concat(t.tag)),void(t.length=e.position-t.dataOffset);t.length=e.byteArray.length-t.dataOffset,e.seek(e.byteArray.length-e.position)}function w(e,t,r){if(r<0)throw"dicomParser.readFixedString - length cannot be less than 0";if(t+r>e.length)throw"dicomParser.readFixedString: attempt to read past end of buffer";for(var a,n="",i=0;i<r;i++){if(0===(a=e[t+i]))return t+=r,n;n+=String.fromCharCode(a)}return n}function b(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function y(e,t){return void 0!==e.parser?e.parser:t}var v=function(){function e(t,r,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.byteArrayParser=t,this.byteArray=r,this.elements=a}var t,r;return t=e,(r=[{key:"uint16",value:function(e,t){if(t=void 0!==t?t:0,(e=this.elements[e])&&0!==e.length)return y(e,this.byteArrayParser).readUint16(this.byteArray,e.dataOffset+2*t)}},{key:"int16",value:function(e,t){if(t=void 0!==t?t:0,(e=this.elements[e])&&0!==e.length)return y(e,this.byteArrayParser).readInt16(this.byteArray,e.dataOffset+2*t)}},{key:"uint32",value:function(e,t){if(t=void 0!==t?t:0,(e=this.elements[e])&&0!==e.length)return y(e,this.byteArrayParser).readUint32(this.byteArray,e.dataOffset+4*t)}},{key:"int32",value:function(e,t){if(t=void 0!==t?t:0,(e=this.elements[e])&&0!==e.length)return y(e,this.byteArrayParser).readInt32(this.byteArray,e.dataOffset+4*t)}},{key:"float",value:function(e,t){if(t=void 0!==t?t:0,(e=this.elements[e])&&0!==e.length)return y(e,this.byteArrayParser).readFloat(this.byteArray,e.dataOffset+4*t)}},{key:"double",value:function(e,t){if(t=void 0!==t?t:0,(e=this.elements[e])&&0!==e.length)return y(e,this.byteArrayParser).readDouble(this.byteArray,e.dataOffset+8*t)}},{key:"numStringValues",value:function(e){if((e=this.elements[e])&&0<e.length)return null===(e=w(this.byteArray,e.dataOffset,e.length).match(/\\/g))?1:e.length+1}},{key:"string",value:function(e,t){return(e=this.elements[e])&&e.Value?e.Value:e&&0<e.length?(e=w(this.byteArray,e.dataOffset,e.length),0<=t?e.split("\\")[t].trim():e.trim()):void 0}},{key:"text",value:function(e,t){if((e=this.elements[e])&&0<e.length)return e=w(this.byteArray,e.dataOffset,e.length),0<=t?e.split("\\")[t].replace(/ +$/,""):e.replace(/ +$/,"")}},{key:"floatString",value:function(e,t){var r=this.elements[e];if(r&&0<r.length&&void 0!==(t=this.string(e,t=void 0!==t?t:0)))return parseFloat(t)}},{key:"intString",value:function(e,t){var r=this.elements[e];if(r&&0<r.length&&void 0!==(t=this.string(e,t=void 0!==t?t:0)))return parseInt(t)}},{key:"attributeTag",value:function(e){if((r=this.elements[e])&&4===r.length){var t=y(r,this.byteArrayParser).readUint16,r=(e=this.byteArray,r.dataOffset);return"x".concat("00000000".concat((256*t(e,r)*256+t(e,r+2)).toString(16)).substr(-8))}}}])&&b(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function x(e,t){if(void 0===e)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";for(var r=e.byteArray.length-8;e.position<=r;)if(65534===e.readUint16()&&57357===e.readUint16())return 0!==e.readUint32()&&e.warnings("encountered non zero length following item delimiter at position ".concat(e.position-4," while reading element of undefined length with tag ").concat(t.tag)),void(t.length=e.position-t.dataOffset);t.length=e.byteArray.length-t.dataOffset,e.seek(e.byteArray.length-e.position)}var A=function(e,t){return void 0!==e.vr?"SQ"===e.vr:t.position+4<=t.byteArray.length?(e=p(t),t.seek(-4),"xfffee000"===e||"xfffee0dd"===e):(t.warnings.push("eof encountered before finding sequence item tag or sequence delimiter tag in peeking to determine VR"),!1)};function k(e,t,r){if(void 0===e)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";var a;return 4294967295===(a={tag:a=p(e),vr:void 0!==r?r(a):void 0,length:e.readUint32(),dataOffset:e.position}).length&&(a.hadUndefinedLength=!0),a.tag===t||(!A(a,e)||i(a.tag)&&!a.hadUndefinedLength?a.hadUndefinedLength?x(e,a):e.seek(a.length):(D(e,a,r),i(a.tag)&&(a.items=void 0))),a}function E(e){if(void 0===e)throw"dicomParser.readSequenceItem: missing required parameter 'byteStream'";var t={tag:p(e),length:e.readUint32(),dataOffset:e.position};if("xfffee000"!==t.tag)throw"dicomParser.readSequenceItem: item tag (FFFE,E000) not found at offset ".concat(e.position);return t}function P(e,t){var r=E(e);return 4294967295===r.length?(r.hadUndefinedLength=!0,r.dataSet=function(e,t){for(var r={};e.position<e.byteArray.length;){var a=k(e,void 0,t);if("xfffee00d"===(r[a.tag]=a).tag)return new v(e.byteArrayParser,e.byteArray,r)}return e.warnings.push("eof encountered before finding sequence item delimiter in sequence item of undefined length"),new v(e.byteArrayParser,e.byteArray,r)}(e,t),r.length=e.position-r.dataOffset):(r.dataSet=new v(e.byteArrayParser,e.byteArray,{}),F(r.dataSet,e,e.position+r.length,{vrCallback:t})),r}function D(e,t,r){if(void 0===e)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'element'";t.items=[],(4294967295===t.length?function(e,t,r){for(;e.position+4<=e.byteArray.length;){var a=p(e);if(e.seek(-4),"xfffee0dd"===a)return t.length=e.position-t.dataOffset,e.seek(8);a=P(e,r),t.items.push(a)}e.warnings.push("eof encountered before finding sequence delimiter in sequence of undefined length"),t.length=e.byteArray.length-t.dataOffset}:function(e,t,r){for(var a=t.dataOffset+t.length;e.position<a;){var n=P(e,r);t.items.push(n)}})(e,t,r)}function S(e,t){var r=E(e);return 4294967295===r.length?(r.hadUndefinedLength=!0,r.dataSet=function(e,t){for(var r={};e.position<e.byteArray.length;){var a=U(e,t);if("xfffee00d"===(r[a.tag]=a).tag)return new v(e.byteArrayParser,e.byteArray,r)}return t.push("eof encountered before finding item delimiter tag while reading sequence item of undefined length"),new v(e.byteArrayParser,e.byteArray,r)}(e,t),r.length=e.position-r.dataOffset):(r.dataSet=new v(e.byteArrayParser,e.byteArray,{}),I(r.dataSet,e,e.position+r.length)),r}function O(e,t,r){if(void 0===e)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'element'";t.items=[],(4294967295===t.length?function(e,t,r){for(;e.position+4<=e.byteArray.length;){var a=p(e);if(e.seek(-4),"xfffee0dd"===a)return t.length=e.position-t.dataOffset,e.seek(8);a=S(e,r),t.items.push(a)}r.push("eof encountered before finding sequence delimitation tag while reading sequence of undefined length"),t.length=e.position-t.dataOffset}:function(e,t,r){for(var a=t.dataOffset+t.length;e.position<a;){var n=S(e,r);t.items.push(n)}})(e,t,r)}var z=function(e){return"OB"===e||"OD"===e||"OL"===e||"OW"===e||"SQ"===e||"OF"===e||"UC"===e||"UR"===e||"UT"===e||"UN"===e?4:2};function U(e,t,r){if(void 0===e)throw"dicomParser.readDicomElementExplicit: missing required parameter 'byteStream'";var a={tag:p(e),vr:e.readFixedString(2)};return 2===z(a.vr)?a.length=e.readUint16():(e.seek(2),a.length=e.readUint32()),a.dataOffset=e.position,4294967295===a.length&&(a.hadUndefinedLength=!0),a.tag===r||("SQ"===a.vr?O(e,a,t):4294967295===a.length?"x7fe00010"===a.tag?g(e,a,t):("UN"===a.vr?D:x)(e,a):e.seek(a.length)),a}function I(e,t,r){var a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};if(r=void 0===r?t.byteArray.length:r,void 0===t)throw"dicomParser.parseDicomDataSetExplicit: missing required parameter 'byteStream'";if(r<t.position||r>t.byteArray.length)throw"dicomParser.parseDicomDataSetExplicit: invalid value for parameter 'maxP osition'";for(var n=e.elements;t.position<r;){var i=U(t,e.warnings,a.untilTag);if((n[i.tag]=i).tag===a.untilTag)return}if(t.position>r)throw"dicomParser:parseDicomDataSetExplicit: buffer overrun"}function F(e,t,r){var a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};if(r=void 0===r?e.byteArray.length:r,void 0===t)throw"dicomParser.parseDicomDataSetImplicit: missing required parameter 'byteStream'";if(r<t.position||r>t.byteArray.length)throw"dicomParser.parseDicomDataSetImplicit: invalid value for parameter 'maxPosition'";for(var n=e.elements;t.position<r;){var i=k(t,a.untilTag,a.vrCallback);if((n[i.tag]=i).tag===a.untilTag)return}}function B(e,t){if("undefined"!=typeof Buffer&&e instanceof Buffer)return Buffer.alloc(t);if(e instanceof Uint8Array)return new Uint8Array(t);throw"dicomParser.alloc: unknown type for byteArray"}var T="1.8.12",R={readUint16:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readUint16: position cannot be less than 0";if(t+2>e.length)throw"bigEndianByteArrayParser.readUint16: attempt to read past end of buffer";return(e[t]<<8)+e[t+1]},readInt16:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readInt16: position cannot be less than 0";if(t+2>e.length)throw"bigEndianByteArrayParser.readInt16: attempt to read past end of buffer";return 32768&(t=(e[t]<<8)+e[t+1])?t-65535-1:t},readUint32:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readUint32: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readUint32: attempt to read past end of buffer";return 256*(256*(256*e[t]+e[t+1])+e[t+2])+e[t+3]},readInt32:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readInt32: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readInt32: attempt to read past end of buffer";return(e[t]<<24)+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3]},readFloat:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readFloat: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readFloat: attempt to read past end of buffer";var r=new Uint8Array(4);return r[3]=e[t],r[2]=e[t+1],r[1]=e[t+2],r[0]=e[t+3],new Float32Array(r.buffer)[0]},readDouble:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readDouble: position cannot be less than 0";if(t+8>e.length)throw"bigEndianByteArrayParser.readDouble: attempt to read past end of buffer";var r=new Uint8Array(8);return r[7]=e[t],r[6]=e[t+1],r[5]=e[t+2],r[4]=e[t+3],r[3]=e[t+4],r[2]=e[t+5],r[1]=e[t+6],r[0]=e[t+7],new Float64Array(r.buffer)[0]}};function C(e,t,r){if("undefined"!=typeof Buffer&&e instanceof Buffer)return e.slice(t,t+r);if(e instanceof Uint8Array)return new Uint8Array(e.buffer,e.byteOffset+t,r);throw"dicomParser.from: unknown type for byteArray"}function L(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var M=function(){function e(t,r,a){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),void 0===t)throw"dicomParser.ByteStream: missing required parameter 'byteArrayParser'";if(void 0===r)throw"dicomParser.ByteStream: missing required parameter 'byteArray'";if(r instanceof Uint8Array==0&&("undefined"==typeof Buffer||r instanceof Buffer==0))throw"dicomParser.ByteStream: parameter byteArray is not of type Uint8Array or Buffer";if(a<0)throw"dicomParser.ByteStream: parameter 'position' cannot be less than 0";if(a>=r.length)throw"dicomParser.ByteStream: parameter 'position' cannot be greater than or equal to 'byteArray' length";this.byteArrayParser=t,this.byteArray=r,this.position=a||0,this.warnings=[]}var t,r;return t=e,(r=[{key:"seek",value:function(e){if(this.position+e<0)throw"dicomParser.ByteStream.prototype.seek: cannot seek to position < 0";this.position+=e}},{key:"readByteStream",value:function(t){if(this.position+t>this.byteArray.length)throw"dicomParser.ByteStream.prototype.readByteStream: readByteStream - buffer overread";var r=C(this.byteArray,this.position,t);return this.position+=t,new e(this.byteArrayParser,r)}},{key:"getSize",value:function(){return this.byteArray.length}},{key:"readUint16",value:function(){var e=this.byteArrayParser.readUint16(this.byteArray,this.position);return this.position+=2,e}},{key:"readUint32",value:function(){var e=this.byteArrayParser.readUint32(this.byteArray,this.position);return this.position+=4,e}},{key:"readFixedString",value:function(e){var t=w(this.byteArray,this.position,e);return this.position+=e,t}}])&&L(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),N={readUint16:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readUint16: position cannot be less than 0";if(t+2>e.length)throw"littleEndianByteArrayParser.readUint16: attempt to read past end of buffer";return e[t]+256*e[t+1]},readInt16:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readInt16: position cannot be less than 0";if(t+2>e.length)throw"littleEndianByteArrayParser.readInt16: attempt to read past end of buffer";return 32768&(t=e[t]+(e[t+1]<<8))?t-65535-1:t},readUint32:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readUint32: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readUint32: attempt to read past end of buffer";return e[t]+256*e[t+1]+256*e[t+2]*256+256*e[t+3]*256*256},readInt32:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readInt32: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readInt32: attempt to read past end of buffer";return e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24)},readFloat:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readFloat: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readFloat: attempt to read past end of buffer";var r=new Uint8Array(4);return r[0]=e[t],r[1]=e[t+1],r[2]=e[t+2],r[3]=e[t+3],new Float32Array(r.buffer)[0]},readDouble:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readDouble: position cannot be less than 0";if(t+8>e.length)throw"littleEndianByteArrayParser.readDouble: attempt to read past end of buffer";var r=new Uint8Array(8);return r[0]=e[t],r[1]=e[t+1],r[2]=e[t+2],r[3]=e[t+3],r[4]=e[t+4],r[5]=e[t+5],r[6]=e[t+6],r[7]=e[t+7],new Float64Array(r.buffer)[0]}};function Z(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(void 0===e)throw"dicomParser.readPart10Header: missing required parameter 'byteArray'";var r=t.TransferSyntaxUID,a=new M(N,e);return function(){var e=function(){if(a.getSize()<=132&&r)return!1;if(a.seek(128),"DICM"===a.readFixedString(4))return!0;if(!(t||{}).TransferSyntaxUID)throw"dicomParser.readPart10Header: DICM prefix not found at location 132 - this is not a valid DICOM P10 file.";return a.seek(0),!1}(),n=[],i={};if(!e)return a.position=0,{elements:{x00020010:{tag:"x00020010",vr:"UI",Value:r}},warnings:n};for(;a.position<a.byteArray.length;){var o=a.position,s=U(a,n);if("x0002ffff"<s.tag){a.position=o;break}s.parser=N,i[s.tag]=s}return(e=new v(a.byteArrayParser,a.byteArray,i)).warnings=a.warnings,e.position=a.position,e}()}var j="1.2.840.10008.1.2.2";function q(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(void 0===e)throw new Error("dicomParser.parseDicom: missing required parameter 'byteArray'");var a,n=function(t){if(void 0===t.elements.x00020010)throw new Error("dicomParser.parseDicom: missing required meta header attribute 0002,0010");return(t=t.elements.x00020010)&&t.Value||w(e,t.dataOffset,t.length)};function i(a){var i="1.2.840.10008.1.2"!==(o=n(a)),o=function(a,n){var i="[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0);if("1.2.840.10008.1.2.1.99"!==a)return new M(a===j?R:N,e,n);if(t&&t.inflater)return a=t.inflater(e,n),new M(N,a,0);if(1==i){var o=r(0),s=C(e,n,e.length-n);return o=o.inflateRawSync(s),s=B(e,o.length+n),e.copy(s,0,0,n),o.copy(s,n),new M(N,s,0)}if("undefined"==typeof pako)throw"dicomParser.parseDicom: no inflater available to handle deflate transfer syntax";return o=e.slice(n),s=pako.inflateRaw(o),(o=B(e,s.length+n)).set(e.slice(0,n),0),o.set(s,n),new M(N,o,0)}(o,a.position);(a=new v(o.byteArrayParser,o.byteArray,{})).warnings=o.warnings;try{(i?I:F)(a,o,o.byteArray.length,t)}catch(o){throw{exception:o,dataSet:a}}return a}return function(e,t){for(var r in e.elements)e.elements.hasOwnProperty(r)&&(t.elements[r]=e.elements[r]);return void 0!==e.warnings&&(t.warnings=e.warnings.concat(t.warnings)),t}(a=Z(e,t),i(a))}var G=function(e,t,r){for(var a=0,n=t;n<t+r;n++)a+=e[n].length;return a};function H(e,t,r,a,n){if(n=n||t.fragments,void 0===e)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'dataSet'";if(void 0===t)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'pixelDataElement'";if(void 0===r)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'startFragmentIndex'";if(void 0===(a=a||1))throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'numFragments'";if("x7fe00010"!==t.tag)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010";if(!0!==t.encapsulatedPixelData)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.basicOffsetTable)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.fragments)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(t.fragments.length<=0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(r<0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be >= 0";if(r>=t.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be < number of fragments";if(a<1)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'numFragments' must be > 0";if(r+a>t.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragment' + 'numFragments' < number of fragments";var i=new M(e.byteArrayParser,e.byteArray,t.dataOffset);if("xfffee000"!==(t=E(i)).tag)throw"dicomParser.readEncapsulatedPixelData: missing basic offset table xfffee000";i.seek(t.length);var o=i.position;if(1===a)return C(i.byteArray,o+n[r].offset+8,n[r].length);t=G(n,r,a);for(var s=B(i.byteArray,t),l=0,d=r;d<r+a;d++)for(var f=o+n[d].offset+8,c=0;c<n[d].length;c++)s[l++]=i.byteArray[f++];return s}var Y=function(e,t){for(var r=0;r<e.length;r++)if(e[r].offset===t)return r},J=function(e,t,r,a){if(e===t.length-1)return r.length-a;for(var n=t[e+1],i=a+1;i<r.length;i++)if(r[i].offset===n)return i-a;throw"dicomParser.calculateNumberOfFragmentsForFrame: could not find fragment with offset matching basic offset table"};function W(e,t,r,a,n){if(a=a||t.basicOffsetTable,n=n||t.fragments,void 0===e)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'dataSet'";if(void 0===t)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'pixelDataElement'";if(void 0===r)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'frameIndex'";if(void 0===a)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' does not have basicOffsetTable";if("x7fe00010"!==t.tag)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010)";if(!0!==t.encapsulatedPixelData)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have undefined length";if(void 0===t.fragments)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have fragments";if(0===a.length)throw"dicomParser.readEncapsulatedImageFrame: basicOffsetTable has zero entries";if(r<0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be >= 0";if(r>=a.length)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be < basicOffsetTable.length";var i=a[r];if(void 0===(i=Y(n,i)))throw"dicomParser.readEncapsulatedImageFrame: unable to find fragment that matches basic offset table entry";return H(e,t,i,J(r,a,n,i),n)}var K=!1;function V(e,t,r){if(K||(K=!0,console&&console.log&&console.log("WARNING: dicomParser.readEncapsulatedPixelData() has been deprecated")),void 0===e)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'dataSet'";if(void 0===t)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'element'";if(void 0===r)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'frame'";if("x7fe00010"!==t.tag)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to non pixel data tag (expected tag = x7fe00010)";if(!0!==t.encapsulatedPixelData)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.basicOffsetTable)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.fragments)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(r<0)throw"dicomParser.readEncapsulatedPixelData: parameter 'frame' must be >= 0";return 0!==t.basicOffsetTable.length?W(e,t,r):H(e,t,0,t.fragments.length)}t.default={isStringVr:n,isPrivateTag:i,parsePN:o,parseTM:s,parseDA:d,explicitElementToString:f,explicitDataSetToJS:c,createJPEGBasicOffsetTable:m,parseDicomDataSetExplicit:I,parseDicomDataSetImplicit:F,readFixedString:w,alloc:B,version:T,bigEndianByteArrayParser:R,ByteStream:M,sharedCopy:C,DataSet:v,findAndSetUNElementLength:_,findEndOfEncapsulatedElement:g,findItemDelimitationItemAndSetElementLength:x,littleEndianByteArrayParser:N,parseDicom:q,readDicomElementExplicit:U,readDicomElementImplicit:k,readEncapsulatedImageFrame:W,readEncapsulatedPixelData:V,readEncapsulatedPixelDataFromFragments:H,readPart10Header:Z,readSequenceItemsExplicit:O,readSequenceItemsImplicit:D,readSequenceItem:E,readTag:p,LEI:"1.2.840.10008.1.2",LEE:"1.2.840.10008.1.2.1"}}],a={},t.m=r,t.c=a,t.d=function(e,r,a){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:a})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(t.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var n in e)t.d(a,n,function(t){return e[t]}.bind(null,n));return a},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=1);function t(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return r[e].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var r,a}(v)}(y)),y.exports),A=_(x);function k(e){let t=e.length;for(;--t>=0;)e[t]=0}const E=256,P=286,D=30,S=15,O=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),z=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),U=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),I=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),F=new Array(576);k(F);const B=new Array(60);k(B);const T=new Array(512);k(T);const R=new Array(256);k(R);const C=new Array(29);k(C);const L=new Array(D);function M(e,t,r,a,n){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=a,this.max_length=n,this.has_stree=e&&e.length}let N,Z,j;function q(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}k(L);const G=e=>e<256?T[e]:T[256+(e>>>7)],H=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},Y=(e,t,r)=>{e.bi_valid>16-r?(e.bi_buf|=t<<e.bi_valid&65535,H(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=r-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)},J=(e,t,r)=>{Y(e,r[2*t],r[2*t+1])},W=(e,t)=>{let r=0;do{r|=1&e,e>>>=1,r<<=1}while(--t>0);return r>>>1},K=(e,t,r)=>{const a=new Array(16);let n,i,o=0;for(n=1;n<=S;n++)o=o+r[n-1]<<1,a[n]=o;for(i=0;i<=t;i++){let t=e[2*i+1];0!==t&&(e[2*i]=W(a[t]++,t))}},V=e=>{let t;for(t=0;t<P;t++)e.dyn_ltree[2*t]=0;for(t=0;t<D;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},Q=e=>{e.bi_valid>8?H(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},X=(e,t,r,a)=>{const n=2*t,i=2*r;return e[n]<e[i]||e[n]===e[i]&&a[t]<=a[r]},$=(e,t,r)=>{const a=e.heap[r];let n=r<<1;for(;n<=e.heap_len&&(n<e.heap_len&&X(t,e.heap[n+1],e.heap[n],e.depth)&&n++,!X(t,a,e.heap[n],e.depth));)e.heap[r]=e.heap[n],r=n,n<<=1;e.heap[r]=a},ee=(e,t,r)=>{let a,n,i,o,s=0;if(0!==e.sym_next)do{a=255&e.pending_buf[e.sym_buf+s++],a+=(255&e.pending_buf[e.sym_buf+s++])<<8,n=e.pending_buf[e.sym_buf+s++],0===a?J(e,n,t):(i=R[n],J(e,i+E+1,t),o=O[i],0!==o&&(n-=C[i],Y(e,n,o)),a--,i=G(a),J(e,i,r),o=z[i],0!==o&&(a-=L[i],Y(e,a,o)))}while(s<e.sym_next);J(e,256,t)},te=(e,t)=>{const r=t.dyn_tree,a=t.stat_desc.static_tree,n=t.stat_desc.has_stree,i=t.stat_desc.elems;let o,s,l,d=-1;for(e.heap_len=0,e.heap_max=573,o=0;o<i;o++)0!==r[2*o]?(e.heap[++e.heap_len]=d=o,e.depth[o]=0):r[2*o+1]=0;for(;e.heap_len<2;)l=e.heap[++e.heap_len]=d<2?++d:0,r[2*l]=1,e.depth[l]=0,e.opt_len--,n&&(e.static_len-=a[2*l+1]);for(t.max_code=d,o=e.heap_len>>1;o>=1;o--)$(e,r,o);l=i;do{o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],$(e,r,1),s=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=s,r[2*l]=r[2*o]+r[2*s],e.depth[l]=(e.depth[o]>=e.depth[s]?e.depth[o]:e.depth[s])+1,r[2*o+1]=r[2*s+1]=l,e.heap[1]=l++,$(e,r,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const r=t.dyn_tree,a=t.max_code,n=t.stat_desc.static_tree,i=t.stat_desc.has_stree,o=t.stat_desc.extra_bits,s=t.stat_desc.extra_base,l=t.stat_desc.max_length;let d,f,c,u,h,m,p=0;for(u=0;u<=S;u++)e.bl_count[u]=0;for(r[2*e.heap[e.heap_max]+1]=0,d=e.heap_max+1;d<573;d++)f=e.heap[d],u=r[2*r[2*f+1]+1]+1,u>l&&(u=l,p++),r[2*f+1]=u,f>a||(e.bl_count[u]++,h=0,f>=s&&(h=o[f-s]),m=r[2*f],e.opt_len+=m*(u+h),i&&(e.static_len+=m*(n[2*f+1]+h)));if(0!==p){do{for(u=l-1;0===e.bl_count[u];)u--;e.bl_count[u]--,e.bl_count[u+1]+=2,e.bl_count[l]--,p-=2}while(p>0);for(u=l;0!==u;u--)for(f=e.bl_count[u];0!==f;)c=e.heap[--d],c>a||(r[2*c+1]!==u&&(e.opt_len+=(u-r[2*c+1])*r[2*c],r[2*c+1]=u),f--)}})(e,t),K(r,d,e.bl_count)},re=(e,t,r)=>{let a,n,i=-1,o=t[1],s=0,l=7,d=4;for(0===o&&(l=138,d=3),t[2*(r+1)+1]=65535,a=0;a<=r;a++)n=o,o=t[2*(a+1)+1],++s<l&&n===o||(s<d?e.bl_tree[2*n]+=s:0!==n?(n!==i&&e.bl_tree[2*n]++,e.bl_tree[32]++):s<=10?e.bl_tree[34]++:e.bl_tree[36]++,s=0,i=n,0===o?(l=138,d=3):n===o?(l=6,d=3):(l=7,d=4))},ae=(e,t,r)=>{let a,n,i=-1,o=t[1],s=0,l=7,d=4;for(0===o&&(l=138,d=3),a=0;a<=r;a++)if(n=o,o=t[2*(a+1)+1],!(++s<l&&n===o)){if(s<d)do{J(e,n,e.bl_tree)}while(0!==--s);else 0!==n?(n!==i&&(J(e,n,e.bl_tree),s--),J(e,16,e.bl_tree),Y(e,s-3,2)):s<=10?(J(e,17,e.bl_tree),Y(e,s-3,3)):(J(e,18,e.bl_tree),Y(e,s-11,7));s=0,i=n,0===o?(l=138,d=3):n===o?(l=6,d=3):(l=7,d=4)}};let ne=!1;const ie=(e,t,r,a)=>{Y(e,0+(a?1:0),3),Q(e),H(e,r),H(e,~r),r&&e.pending_buf.set(e.window.subarray(t,t+r),e.pending),e.pending+=r};var oe=(e,t,r,a)=>{let n,i,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<E;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),te(e,e.l_desc),te(e,e.d_desc),o=(e=>{let t;for(re(e,e.dyn_ltree,e.l_desc.max_code),re(e,e.dyn_dtree,e.d_desc.max_code),te(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*I[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),n=e.opt_len+3+7>>>3,i=e.static_len+3+7>>>3,i<=n&&(n=i)):n=i=r+5,r+4<=n&&-1!==t?ie(e,t,r,a):4===e.strategy||i===n?(Y(e,2+(a?1:0),3),ee(e,F,B)):(Y(e,4+(a?1:0),3),((e,t,r,a)=>{let n;for(Y(e,t-257,5),Y(e,r-1,5),Y(e,a-4,4),n=0;n<a;n++)Y(e,e.bl_tree[2*I[n]+1],3);ae(e,e.dyn_ltree,t-1),ae(e,e.dyn_dtree,r-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),ee(e,e.dyn_ltree,e.dyn_dtree)),V(e),a&&Q(e)},se={_tr_init:e=>{ne||((()=>{let e,t,r,a,n;const i=new Array(16);for(r=0,a=0;a<28;a++)for(C[a]=r,e=0;e<1<<O[a];e++)R[r++]=a;for(R[r-1]=a,n=0,a=0;a<16;a++)for(L[a]=n,e=0;e<1<<z[a];e++)T[n++]=a;for(n>>=7;a<D;a++)for(L[a]=n<<7,e=0;e<1<<z[a]-7;e++)T[256+n++]=a;for(t=0;t<=S;t++)i[t]=0;for(e=0;e<=143;)F[2*e+1]=8,e++,i[8]++;for(;e<=255;)F[2*e+1]=9,e++,i[9]++;for(;e<=279;)F[2*e+1]=7,e++,i[7]++;for(;e<=287;)F[2*e+1]=8,e++,i[8]++;for(K(F,287,i),e=0;e<D;e++)B[2*e+1]=5,B[2*e]=W(e,5);N=new M(F,O,257,P,S),Z=new M(B,z,0,D,S),j=new M(new Array(0),U,0,19,7)})(),ne=!0),e.l_desc=new q(e.dyn_ltree,N),e.d_desc=new q(e.dyn_dtree,Z),e.bl_desc=new q(e.bl_tree,j),e.bi_buf=0,e.bi_valid=0,V(e)},_tr_stored_block:ie,_tr_flush_block:oe,_tr_tally:(e,t,r)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=r,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(R[r]+E+1)]++,e.dyn_dtree[2*G(t)]++),e.sym_next===e.sym_end),_tr_align:e=>{Y(e,2,3),J(e,256,F),(e=>{16===e.bi_valid?(H(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}};var le=(e,t,r,a)=>{let n=65535&e,i=e>>>16&65535,o=0;for(;0!==r;){o=r>2e3?2e3:r,r-=o;do{n=n+t[a++]|0,i=i+n|0}while(--o);n%=65521,i%=65521}return n|i<<16};const de=new Uint32Array((()=>{let e,t=[];for(var r=0;r<256;r++){e=r;for(var a=0;a<8;a++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t})());var fe=(e,t,r,a)=>{const n=de,i=a+r;e^=-1;for(let r=a;r<i;r++)e=e>>>8^n[255&(e^t[r])];return-1^e},ce={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},ue={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:he,_tr_stored_block:me,_tr_flush_block:pe,_tr_tally:ge,_tr_align:_e}=se,{Z_NO_FLUSH:we,Z_PARTIAL_FLUSH:be,Z_FULL_FLUSH:ye,Z_FINISH:ve,Z_BLOCK:xe,Z_OK:Ae,Z_STREAM_END:ke,Z_STREAM_ERROR:Ee,Z_DATA_ERROR:Pe,Z_BUF_ERROR:De,Z_DEFAULT_COMPRESSION:Se,Z_FILTERED:Oe,Z_HUFFMAN_ONLY:ze,Z_RLE:Ue,Z_FIXED:Ie,Z_DEFAULT_STRATEGY:Fe,Z_UNKNOWN:Be,Z_DEFLATED:Te}=ue,Re=258,Ce=262,Le=42,Me=113,Ne=666,Ze=(e,t)=>(e.msg=ce[t],t),je=e=>2*e-(e>4?9:0),qe=e=>{let t=e.length;for(;--t>=0;)e[t]=0},Ge=e=>{let t,r,a,n=e.w_size;t=e.hash_size,a=t;do{r=e.head[--a],e.head[a]=r>=n?r-n:0}while(--t);t=n,a=t;do{r=e.prev[--a],e.prev[a]=r>=n?r-n:0}while(--t)};let He=(e,t,r)=>(t<<e.hash_shift^r)&e.hash_mask;const Ye=e=>{const t=e.state;let r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+r),e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))},Je=(e,t)=>{pe(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Ye(e.strm)},We=(e,t)=>{e.pending_buf[e.pending++]=t},Ke=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},Ve=(e,t,r,a)=>{let n=e.avail_in;return n>a&&(n=a),0===n?0:(e.avail_in-=n,t.set(e.input.subarray(e.next_in,e.next_in+n),r),1===e.state.wrap?e.adler=le(e.adler,t,n,r):2===e.state.wrap&&(e.adler=fe(e.adler,t,n,r)),e.next_in+=n,e.total_in+=n,n)},Qe=(e,t)=>{let r,a,n=e.max_chain_length,i=e.strstart,o=e.prev_length,s=e.nice_match;const l=e.strstart>e.w_size-Ce?e.strstart-(e.w_size-Ce):0,d=e.window,f=e.w_mask,c=e.prev,u=e.strstart+Re;let h=d[i+o-1],m=d[i+o];e.prev_length>=e.good_match&&(n>>=2),s>e.lookahead&&(s=e.lookahead);do{if(r=t,d[r+o]===m&&d[r+o-1]===h&&d[r]===d[i]&&d[++r]===d[i+1]){i+=2,r++;do{}while(d[++i]===d[++r]&&d[++i]===d[++r]&&d[++i]===d[++r]&&d[++i]===d[++r]&&d[++i]===d[++r]&&d[++i]===d[++r]&&d[++i]===d[++r]&&d[++i]===d[++r]&&i<u);if(a=Re-(u-i),i=u-Re,a>o){if(e.match_start=t,o=a,a>=s)break;h=d[i+o-1],m=d[i+o]}}}while((t=c[t&f])>l&&0!==--n);return o<=e.lookahead?o:e.lookahead},Xe=e=>{const t=e.w_size;let r,a,n;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Ce)&&(e.window.set(e.window.subarray(t,t+t-a),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),Ge(e),a+=t),0===e.strm.avail_in)break;if(r=Ve(e.strm,e.window,e.strstart+e.lookahead,a),e.lookahead+=r,e.lookahead+e.insert>=3)for(n=e.strstart-e.insert,e.ins_h=e.window[n],e.ins_h=He(e,e.ins_h,e.window[n+1]);e.insert&&(e.ins_h=He(e,e.ins_h,e.window[n+3-1]),e.prev[n&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=n,n++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Ce&&0!==e.strm.avail_in)},$e=(e,t)=>{let r,a,n,i=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,o=0,s=e.strm.avail_in;do{if(r=65535,n=e.bi_valid+42>>3,e.strm.avail_out<n)break;if(n=e.strm.avail_out-n,a=e.strstart-e.block_start,r>a+e.strm.avail_in&&(r=a+e.strm.avail_in),r>n&&(r=n),r<i&&(0===r&&t!==ve||t===we||r!==a+e.strm.avail_in))break;o=t===ve&&r===a+e.strm.avail_in?1:0,me(e,0,0,o),e.pending_buf[e.pending-4]=r,e.pending_buf[e.pending-3]=r>>8,e.pending_buf[e.pending-2]=~r,e.pending_buf[e.pending-1]=~r>>8,Ye(e.strm),a&&(a>r&&(a=r),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+a),e.strm.next_out),e.strm.next_out+=a,e.strm.avail_out-=a,e.strm.total_out+=a,e.block_start+=a,r-=a),r&&(Ve(e.strm,e.strm.output,e.strm.next_out,r),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r)}while(0===o);return s-=e.strm.avail_in,s&&(s>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=s&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-s,e.strm.next_in),e.strstart),e.strstart+=s,e.insert+=s>e.w_size-e.insert?e.w_size-e.insert:s),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),o?4:t!==we&&t!==ve&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(n=e.window_size-e.strstart,e.strm.avail_in>n&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,n+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),n>e.strm.avail_in&&(n=e.strm.avail_in),n&&(Ve(e.strm,e.window,e.strstart,n),e.strstart+=n,e.insert+=n>e.w_size-e.insert?e.w_size-e.insert:n),e.high_water<e.strstart&&(e.high_water=e.strstart),n=e.bi_valid+42>>3,n=e.pending_buf_size-n>65535?65535:e.pending_buf_size-n,i=n>e.w_size?e.w_size:n,a=e.strstart-e.block_start,(a>=i||(a||t===ve)&&t!==we&&0===e.strm.avail_in&&a<=n)&&(r=a>n?n:a,o=t===ve&&0===e.strm.avail_in&&r===a?1:0,me(e,e.block_start,r,o),e.block_start+=r,Ye(e.strm)),o?3:1)},et=(e,t)=>{let r,a;for(;;){if(e.lookahead<Ce){if(Xe(e),e.lookahead<Ce&&t===we)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=He(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-Ce&&(e.match_length=Qe(e,r)),e.match_length>=3)if(a=ge(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=He(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!==--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=He(e,e.ins_h,e.window[e.strstart+1]);else a=ge(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(a&&(Je(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===ve?(Je(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Je(e,!1),0===e.strm.avail_out)?1:2},tt=(e,t)=>{let r,a,n;for(;;){if(e.lookahead<Ce){if(Xe(e),e.lookahead<Ce&&t===we)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=He(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-Ce&&(e.match_length=Qe(e,r),e.match_length<=5&&(e.strategy===Oe||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){n=e.strstart+e.lookahead-3,a=ge(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=n&&(e.ins_h=He(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!==--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,a&&(Je(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(a=ge(e,0,e.window[e.strstart-1]),a&&Je(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(a=ge(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===ve?(Je(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Je(e,!1),0===e.strm.avail_out)?1:2};function rt(e,t,r,a,n){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=a,this.func=n}const at=[new rt(0,0,0,0,$e),new rt(4,4,8,4,et),new rt(4,5,16,8,et),new rt(4,6,32,32,et),new rt(4,4,16,16,tt),new rt(8,16,32,32,tt),new rt(8,16,128,128,tt),new rt(8,32,128,256,tt),new rt(32,128,258,1024,tt),new rt(32,258,258,4096,tt)];function nt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Te,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),qe(this.dyn_ltree),qe(this.dyn_dtree),qe(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),qe(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),qe(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const it=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==Le&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==Me&&t.status!==Ne?1:0},ot=e=>{if(it(e))return Ze(e,Ee);e.total_in=e.total_out=0,e.data_type=Be;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?Le:Me,e.adler=2===t.wrap?0:1,t.last_flush=-2,he(t),Ae},st=e=>{const t=ot(e);var r;return t===Ae&&((r=e.state).window_size=2*r.w_size,qe(r.head),r.max_lazy_match=at[r.level].max_lazy,r.good_match=at[r.level].good_length,r.nice_match=at[r.level].nice_length,r.max_chain_length=at[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=2,r.match_available=0,r.ins_h=0),t},lt=(e,t,r,a,n,i)=>{if(!e)return Ee;let o=1;if(t===Se&&(t=6),a<0?(o=0,a=-a):a>15&&(o=2,a-=16),n<1||n>9||r!==Te||a<8||a>15||t<0||t>9||i<0||i>Ie||8===a&&1!==o)return Ze(e,Ee);8===a&&(a=9);const s=new nt;return e.state=s,s.strm=e,s.status=Le,s.wrap=o,s.gzhead=null,s.w_bits=a,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=n+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+3-1)/3),s.window=new Uint8Array(2*s.w_size),s.head=new Uint16Array(s.hash_size),s.prev=new Uint16Array(s.w_size),s.lit_bufsize=1<<n+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new Uint8Array(s.pending_buf_size),s.sym_buf=s.lit_bufsize,s.sym_end=3*(s.lit_bufsize-1),s.level=t,s.strategy=i,s.method=r,st(e)};var dt={deflateInit:(e,t)=>lt(e,t,Te,15,8,Fe),deflateInit2:lt,deflateReset:st,deflateResetKeep:ot,deflateSetHeader:(e,t)=>it(e)||2!==e.state.wrap?Ee:(e.state.gzhead=t,Ae),deflate:(e,t)=>{if(it(e)||t>xe||t<0)return e?Ze(e,Ee):Ee;const r=e.state;if(!e.output||0!==e.avail_in&&!e.input||r.status===Ne&&t!==ve)return Ze(e,0===e.avail_out?De:Ee);const a=r.last_flush;if(r.last_flush=t,0!==r.pending){if(Ye(e),0===e.avail_out)return r.last_flush=-1,Ae}else if(0===e.avail_in&&je(t)<=je(a)&&t!==ve)return Ze(e,De);if(r.status===Ne&&0!==e.avail_in)return Ze(e,De);if(r.status===Le&&0===r.wrap&&(r.status=Me),r.status===Le){let t=Te+(r.w_bits-8<<4)<<8,a=-1;if(a=r.strategy>=ze||r.level<2?0:r.level<6?1:6===r.level?2:3,t|=a<<6,0!==r.strstart&&(t|=32),t+=31-t%31,Ke(r,t),0!==r.strstart&&(Ke(r,e.adler>>>16),Ke(r,65535&e.adler)),e.adler=1,r.status=Me,Ye(e),0!==r.pending)return r.last_flush=-1,Ae}if(57===r.status)if(e.adler=0,We(r,31),We(r,139),We(r,8),r.gzhead)We(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),We(r,255&r.gzhead.time),We(r,r.gzhead.time>>8&255),We(r,r.gzhead.time>>16&255),We(r,r.gzhead.time>>24&255),We(r,9===r.level?2:r.strategy>=ze||r.level<2?4:0),We(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(We(r,255&r.gzhead.extra.length),We(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=fe(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69;else if(We(r,0),We(r,0),We(r,0),We(r,0),We(r,0),We(r,9===r.level?2:r.strategy>=ze||r.level<2?4:0),We(r,3),r.status=Me,Ye(e),0!==r.pending)return r.last_flush=-1,Ae;if(69===r.status){if(r.gzhead.extra){let t=r.pending,a=(65535&r.gzhead.extra.length)-r.gzindex;for(;r.pending+a>r.pending_buf_size;){let n=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+n),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>t&&(e.adler=fe(e.adler,r.pending_buf,r.pending-t,t)),r.gzindex+=n,Ye(e),0!==r.pending)return r.last_flush=-1,Ae;t=0,a-=n}let n=new Uint8Array(r.gzhead.extra);r.pending_buf.set(n.subarray(r.gzindex,r.gzindex+a),r.pending),r.pending+=a,r.gzhead.hcrc&&r.pending>t&&(e.adler=fe(e.adler,r.pending_buf,r.pending-t,t)),r.gzindex=0}r.status=73}if(73===r.status){if(r.gzhead.name){let t,a=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>a&&(e.adler=fe(e.adler,r.pending_buf,r.pending-a,a)),Ye(e),0!==r.pending)return r.last_flush=-1,Ae;a=0}t=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,We(r,t)}while(0!==t);r.gzhead.hcrc&&r.pending>a&&(e.adler=fe(e.adler,r.pending_buf,r.pending-a,a)),r.gzindex=0}r.status=91}if(91===r.status){if(r.gzhead.comment){let t,a=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>a&&(e.adler=fe(e.adler,r.pending_buf,r.pending-a,a)),Ye(e),0!==r.pending)return r.last_flush=-1,Ae;a=0}t=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,We(r,t)}while(0!==t);r.gzhead.hcrc&&r.pending>a&&(e.adler=fe(e.adler,r.pending_buf,r.pending-a,a))}r.status=103}if(103===r.status){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&(Ye(e),0!==r.pending))return r.last_flush=-1,Ae;We(r,255&e.adler),We(r,e.adler>>8&255),e.adler=0}if(r.status=Me,Ye(e),0!==r.pending)return r.last_flush=-1,Ae}if(0!==e.avail_in||0!==r.lookahead||t!==we&&r.status!==Ne){let a=0===r.level?$e(r,t):r.strategy===ze?((e,t)=>{let r;for(;;){if(0===e.lookahead&&(Xe(e),0===e.lookahead)){if(t===we)return 1;break}if(e.match_length=0,r=ge(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(Je(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===ve?(Je(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Je(e,!1),0===e.strm.avail_out)?1:2})(r,t):r.strategy===Ue?((e,t)=>{let r,a,n,i;const o=e.window;for(;;){if(e.lookahead<=Re){if(Xe(e),e.lookahead<=Re&&t===we)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(n=e.strstart-1,a=o[n],a===o[++n]&&a===o[++n]&&a===o[++n])){i=e.strstart+Re;do{}while(a===o[++n]&&a===o[++n]&&a===o[++n]&&a===o[++n]&&a===o[++n]&&a===o[++n]&&a===o[++n]&&a===o[++n]&&n<i);e.match_length=Re-(i-n),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(r=ge(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=ge(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(Je(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===ve?(Je(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Je(e,!1),0===e.strm.avail_out)?1:2})(r,t):at[r.level].func(r,t);if(3!==a&&4!==a||(r.status=Ne),1===a||3===a)return 0===e.avail_out&&(r.last_flush=-1),Ae;if(2===a&&(t===be?_e(r):t!==xe&&(me(r,0,0,!1),t===ye&&(qe(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),Ye(e),0===e.avail_out))return r.last_flush=-1,Ae}return t!==ve?Ae:r.wrap<=0?ke:(2===r.wrap?(We(r,255&e.adler),We(r,e.adler>>8&255),We(r,e.adler>>16&255),We(r,e.adler>>24&255),We(r,255&e.total_in),We(r,e.total_in>>8&255),We(r,e.total_in>>16&255),We(r,e.total_in>>24&255)):(Ke(r,e.adler>>>16),Ke(r,65535&e.adler)),Ye(e),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?Ae:ke)},deflateEnd:e=>{if(it(e))return Ee;const t=e.state.status;return e.state=null,t===Me?Ze(e,Pe):Ae},deflateSetDictionary:(e,t)=>{let r=t.length;if(it(e))return Ee;const a=e.state,n=a.wrap;if(2===n||1===n&&a.status!==Le||a.lookahead)return Ee;if(1===n&&(e.adler=le(e.adler,t,r,0)),a.wrap=0,r>=a.w_size){0===n&&(qe(a.head),a.strstart=0,a.block_start=0,a.insert=0);let e=new Uint8Array(a.w_size);e.set(t.subarray(r-a.w_size,r),0),t=e,r=a.w_size}const i=e.avail_in,o=e.next_in,s=e.input;for(e.avail_in=r,e.next_in=0,e.input=t,Xe(a);a.lookahead>=3;){let e=a.strstart,t=a.lookahead-2;do{a.ins_h=He(a,a.ins_h,a.window[e+3-1]),a.prev[e&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=e,e++}while(--t);a.strstart=e,a.lookahead=2,Xe(a)}return a.strstart+=a.lookahead,a.block_start=a.strstart,a.insert=a.lookahead,a.lookahead=0,a.match_length=a.prev_length=2,a.match_available=0,e.next_in=o,e.input=s,e.avail_in=i,a.wrap=n,Ae},deflateInfo:"pako deflate (from Nodeca project)"};const ft=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var ct=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const r=t.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(const t in r)ft(r,t)&&(e[t]=r[t])}}return e},ut=e=>{let t=0;for(let r=0,a=e.length;r<a;r++)t+=e[r].length;const r=new Uint8Array(t);for(let t=0,a=0,n=e.length;t<n;t++){let n=e[t];r.set(n,a),a+=n.length}return r};let ht=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){ht=!1}const mt=new Uint8Array(256);for(let e=0;e<256;e++)mt[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;mt[254]=mt[254]=1;var pt=e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,r,a,n,i,o=e.length,s=0;for(n=0;n<o;n++)r=e.charCodeAt(n),55296==(64512&r)&&n+1<o&&(a=e.charCodeAt(n+1),56320==(64512&a)&&(r=65536+(r-55296<<10)+(a-56320),n++)),s+=r<128?1:r<2048?2:r<65536?3:4;for(t=new Uint8Array(s),i=0,n=0;i<s;n++)r=e.charCodeAt(n),55296==(64512&r)&&n+1<o&&(a=e.charCodeAt(n+1),56320==(64512&a)&&(r=65536+(r-55296<<10)+(a-56320),n++)),r<128?t[i++]=r:r<2048?(t[i++]=192|r>>>6,t[i++]=128|63&r):r<65536?(t[i++]=224|r>>>12,t[i++]=128|r>>>6&63,t[i++]=128|63&r):(t[i++]=240|r>>>18,t[i++]=128|r>>>12&63,t[i++]=128|r>>>6&63,t[i++]=128|63&r);return t},gt=(e,t)=>{const r=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let a,n;const i=new Array(2*r);for(n=0,a=0;a<r;){let t=e[a++];if(t<128){i[n++]=t;continue}let o=mt[t];if(o>4)i[n++]=65533,a+=o-1;else{for(t&=2===o?31:3===o?15:7;o>1&&a<r;)t=t<<6|63&e[a++],o--;o>1?i[n++]=65533:t<65536?i[n++]=t:(t-=65536,i[n++]=55296|t>>10&1023,i[n++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&ht)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let r="";for(let a=0;a<t;a++)r+=String.fromCharCode(e[a]);return r})(i,n)},_t=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let r=t-1;for(;r>=0&&128==(192&e[r]);)r--;return r<0||0===r?t:r+mt[e[r]]>t?r:t};var wt=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const bt=Object.prototype.toString,{Z_NO_FLUSH:yt,Z_SYNC_FLUSH:vt,Z_FULL_FLUSH:xt,Z_FINISH:At,Z_OK:kt,Z_STREAM_END:Et,Z_DEFAULT_COMPRESSION:Pt,Z_DEFAULT_STRATEGY:Dt,Z_DEFLATED:St}=ue;function Ot(e){this.options=ct({level:Pt,method:St,chunkSize:16384,windowBits:15,memLevel:8,strategy:Dt},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new wt,this.strm.avail_out=0;let r=dt.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==kt)throw new Error(ce[r]);if(t.header&&dt.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?pt(t.dictionary):"[object ArrayBuffer]"===bt.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,r=dt.deflateSetDictionary(this.strm,e),r!==kt)throw new Error(ce[r]);this._dict_set=!0}}function zt(e,t){const r=new Ot(t);if(r.push(e,!0),r.err)throw r.msg||ce[r.err];return r.result}Ot.prototype.push=function(e,t){const r=this.strm,a=this.options.chunkSize;let n,i;if(this.ended)return!1;for(i=t===~~t?t:!0===t?At:yt,"string"==typeof e?r.input=pt(e):"[object ArrayBuffer]"===bt.call(e)?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;)if(0===r.avail_out&&(r.output=new Uint8Array(a),r.next_out=0,r.avail_out=a),(i===vt||i===xt)&&r.avail_out<=6)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else{if(n=dt.deflate(r,i),n===Et)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),n=dt.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===kt;if(0!==r.avail_out){if(i>0&&r.next_out>0)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else if(0===r.avail_in)break}else this.onData(r.output)}return!0},Ot.prototype.onData=function(e){this.chunks.push(e)},Ot.prototype.onEnd=function(e){e===kt&&(this.result=ut(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Ut={Deflate:Ot,deflate:zt,deflateRaw:function(e,t){return(t=t||{}).raw=!0,zt(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,zt(e,t)}};const It=16209;var Ft=function(e,t){let r,a,n,i,o,s,l,d,f,c,u,h,m,p,g,_,w,b,y,v,x,A,k,E;const P=e.state;r=e.next_in,k=e.input,a=r+(e.avail_in-5),n=e.next_out,E=e.output,i=n-(t-e.avail_out),o=n+(e.avail_out-257),s=P.dmax,l=P.wsize,d=P.whave,f=P.wnext,c=P.window,u=P.hold,h=P.bits,m=P.lencode,p=P.distcode,g=(1<<P.lenbits)-1,_=(1<<P.distbits)-1;e:do{h<15&&(u+=k[r++]<<h,h+=8,u+=k[r++]<<h,h+=8),w=m[u&g];t:for(;;){if(b=w>>>24,u>>>=b,h-=b,b=w>>>16&255,0===b)E[n++]=65535&w;else{if(!(16&b)){if(64&b){if(32&b){P.mode=16191;break e}e.msg="invalid literal/length code",P.mode=It;break e}w=m[(65535&w)+(u&(1<<b)-1)];continue t}for(y=65535&w,b&=15,b&&(h<b&&(u+=k[r++]<<h,h+=8),y+=u&(1<<b)-1,u>>>=b,h-=b),h<15&&(u+=k[r++]<<h,h+=8,u+=k[r++]<<h,h+=8),w=p[u&_];;){if(b=w>>>24,u>>>=b,h-=b,b=w>>>16&255,16&b){if(v=65535&w,b&=15,h<b&&(u+=k[r++]<<h,h+=8,h<b&&(u+=k[r++]<<h,h+=8)),v+=u&(1<<b)-1,v>s){e.msg="invalid distance too far back",P.mode=It;break e}if(u>>>=b,h-=b,b=n-i,v>b){if(b=v-b,b>d&&P.sane){e.msg="invalid distance too far back",P.mode=It;break e}if(x=0,A=c,0===f){if(x+=l-b,b<y){y-=b;do{E[n++]=c[x++]}while(--b);x=n-v,A=E}}else if(f<b){if(x+=l+f-b,b-=f,b<y){y-=b;do{E[n++]=c[x++]}while(--b);if(x=0,f<y){b=f,y-=b;do{E[n++]=c[x++]}while(--b);x=n-v,A=E}}}else if(x+=f-b,b<y){y-=b;do{E[n++]=c[x++]}while(--b);x=n-v,A=E}for(;y>2;)E[n++]=A[x++],E[n++]=A[x++],E[n++]=A[x++],y-=3;y&&(E[n++]=A[x++],y>1&&(E[n++]=A[x++]))}else{x=n-v;do{E[n++]=E[x++],E[n++]=E[x++],E[n++]=E[x++],y-=3}while(y>2);y&&(E[n++]=E[x++],y>1&&(E[n++]=E[x++]))}break}if(64&b){e.msg="invalid distance code",P.mode=It;break e}w=p[(65535&w)+(u&(1<<b)-1)]}}break}}while(r<a&&n<o);y=h>>3,r-=y,h-=y<<3,u&=(1<<h)-1,e.next_in=r,e.next_out=n,e.avail_in=r<a?a-r+5:5-(r-a),e.avail_out=n<o?o-n+257:257-(n-o),P.hold=u,P.bits=h};const Bt=15,Tt=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Rt=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Ct=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Lt=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Mt=(e,t,r,a,n,i,o,s)=>{const l=s.bits;let d,f,c,u,h,m,p=0,g=0,_=0,w=0,b=0,y=0,v=0,x=0,A=0,k=0,E=null;const P=new Uint16Array(16),D=new Uint16Array(16);let S,O,z,U=null;for(p=0;p<=Bt;p++)P[p]=0;for(g=0;g<a;g++)P[t[r+g]]++;for(b=l,w=Bt;w>=1&&0===P[w];w--);if(b>w&&(b=w),0===w)return n[i++]=20971520,n[i++]=20971520,s.bits=1,0;for(_=1;_<w&&0===P[_];_++);for(b<_&&(b=_),x=1,p=1;p<=Bt;p++)if(x<<=1,x-=P[p],x<0)return-1;if(x>0&&(0===e||1!==w))return-1;for(D[1]=0,p=1;p<Bt;p++)D[p+1]=D[p]+P[p];for(g=0;g<a;g++)0!==t[r+g]&&(o[D[t[r+g]]++]=g);if(0===e?(E=U=o,m=20):1===e?(E=Tt,U=Rt,m=257):(E=Ct,U=Lt,m=0),k=0,g=0,p=_,h=i,y=b,v=0,c=-1,A=1<<b,u=A-1,1===e&&A>852||2===e&&A>592)return 1;for(;;){S=p-v,o[g]+1<m?(O=0,z=o[g]):o[g]>=m?(O=U[o[g]-m],z=E[o[g]-m]):(O=96,z=0),d=1<<p-v,f=1<<y,_=f;do{f-=d,n[h+(k>>v)+f]=S<<24|O<<16|z}while(0!==f);for(d=1<<p-1;k&d;)d>>=1;if(0!==d?(k&=d-1,k+=d):k=0,g++,0===--P[p]){if(p===w)break;p=t[r+o[g]]}if(p>b&&(k&u)!==c){for(0===v&&(v=b),h+=_,y=p-v,x=1<<y;y+v<w&&(x-=P[y+v],!(x<=0));)y++,x<<=1;if(A+=1<<y,1===e&&A>852||2===e&&A>592)return 1;c=k&u,n[c]=b<<24|y<<16|h-i}}return 0!==k&&(n[h+k]=p-v<<24|64<<16),s.bits=b,0};const{Z_FINISH:Nt,Z_BLOCK:Zt,Z_TREES:jt,Z_OK:qt,Z_STREAM_END:Gt,Z_NEED_DICT:Ht,Z_STREAM_ERROR:Yt,Z_DATA_ERROR:Jt,Z_MEM_ERROR:Wt,Z_BUF_ERROR:Kt,Z_DEFLATED:Vt}=ue,Qt=16180,Xt=16190,$t=16191,er=16192,tr=16194,rr=16199,ar=16200,nr=16206,ir=16209,or=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function sr(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const lr=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<Qt||t.mode>16211?1:0},dr=e=>{if(lr(e))return Yt;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=Qt,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,qt},fr=e=>{if(lr(e))return Yt;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,dr(e)},cr=(e,t)=>{let r;if(lr(e))return Yt;const a=e.state;return t<0?(r=0,t=-t):(r=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Yt:(null!==a.window&&a.wbits!==t&&(a.window=null),a.wrap=r,a.wbits=t,fr(e))},ur=(e,t)=>{if(!e)return Yt;const r=new sr;e.state=r,r.strm=e,r.window=null,r.mode=Qt;const a=cr(e,t);return a!==qt&&(e.state=null),a};let hr,mr,pr=!0;const gr=e=>{if(pr){hr=new Int32Array(512),mr=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Mt(1,e.lens,0,288,hr,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Mt(2,e.lens,0,32,mr,0,e.work,{bits:5}),pr=!1}e.lencode=hr,e.lenbits=9,e.distcode=mr,e.distbits=5},_r=(e,t,r,a)=>{let n;const i=e.state;return null===i.window&&(i.wsize=1<<i.wbits,i.wnext=0,i.whave=0,i.window=new Uint8Array(i.wsize)),a>=i.wsize?(i.window.set(t.subarray(r-i.wsize,r),0),i.wnext=0,i.whave=i.wsize):(n=i.wsize-i.wnext,n>a&&(n=a),i.window.set(t.subarray(r-a,r-a+n),i.wnext),(a-=n)?(i.window.set(t.subarray(r-a,r),0),i.wnext=a,i.whave=i.wsize):(i.wnext+=n,i.wnext===i.wsize&&(i.wnext=0),i.whave<i.wsize&&(i.whave+=n))),0};var wr={inflateReset:fr,inflateReset2:cr,inflateResetKeep:dr,inflateInit:e=>ur(e,15),inflateInit2:ur,inflate:(e,t)=>{let r,a,n,i,o,s,l,d,f,c,u,h,m,p,g,_,w,b,y,v,x,A,k=0;const E=new Uint8Array(4);let P,D;const S=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(lr(e)||!e.output||!e.input&&0!==e.avail_in)return Yt;r=e.state,r.mode===$t&&(r.mode=er),o=e.next_out,n=e.output,l=e.avail_out,i=e.next_in,a=e.input,s=e.avail_in,d=r.hold,f=r.bits,c=s,u=l,A=qt;e:for(;;)switch(r.mode){case Qt:if(0===r.wrap){r.mode=er;break}for(;f<16;){if(0===s)break e;s--,d+=a[i++]<<f,f+=8}if(2&r.wrap&&35615===d){0===r.wbits&&(r.wbits=15),r.check=0,E[0]=255&d,E[1]=d>>>8&255,r.check=fe(r.check,E,2,0),d=0,f=0,r.mode=16181;break}if(r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&d)<<8)+(d>>8))%31){e.msg="incorrect header check",r.mode=ir;break}if((15&d)!==Vt){e.msg="unknown compression method",r.mode=ir;break}if(d>>>=4,f-=4,x=8+(15&d),0===r.wbits&&(r.wbits=x),x>15||x>r.wbits){e.msg="invalid window size",r.mode=ir;break}r.dmax=1<<r.wbits,r.flags=0,e.adler=r.check=1,r.mode=512&d?16189:$t,d=0,f=0;break;case 16181:for(;f<16;){if(0===s)break e;s--,d+=a[i++]<<f,f+=8}if(r.flags=d,(255&r.flags)!==Vt){e.msg="unknown compression method",r.mode=ir;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=ir;break}r.head&&(r.head.text=d>>8&1),512&r.flags&&4&r.wrap&&(E[0]=255&d,E[1]=d>>>8&255,r.check=fe(r.check,E,2,0)),d=0,f=0,r.mode=16182;case 16182:for(;f<32;){if(0===s)break e;s--,d+=a[i++]<<f,f+=8}r.head&&(r.head.time=d),512&r.flags&&4&r.wrap&&(E[0]=255&d,E[1]=d>>>8&255,E[2]=d>>>16&255,E[3]=d>>>24&255,r.check=fe(r.check,E,4,0)),d=0,f=0,r.mode=16183;case 16183:for(;f<16;){if(0===s)break e;s--,d+=a[i++]<<f,f+=8}r.head&&(r.head.xflags=255&d,r.head.os=d>>8),512&r.flags&&4&r.wrap&&(E[0]=255&d,E[1]=d>>>8&255,r.check=fe(r.check,E,2,0)),d=0,f=0,r.mode=16184;case 16184:if(1024&r.flags){for(;f<16;){if(0===s)break e;s--,d+=a[i++]<<f,f+=8}r.length=d,r.head&&(r.head.extra_len=d),512&r.flags&&4&r.wrap&&(E[0]=255&d,E[1]=d>>>8&255,r.check=fe(r.check,E,2,0)),d=0,f=0}else r.head&&(r.head.extra=null);r.mode=16185;case 16185:if(1024&r.flags&&(h=r.length,h>s&&(h=s),h&&(r.head&&(x=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(a.subarray(i,i+h),x)),512&r.flags&&4&r.wrap&&(r.check=fe(r.check,a,h,i)),s-=h,i+=h,r.length-=h),r.length))break e;r.length=0,r.mode=16186;case 16186:if(2048&r.flags){if(0===s)break e;h=0;do{x=a[i+h++],r.head&&x&&r.length<65536&&(r.head.name+=String.fromCharCode(x))}while(x&&h<s);if(512&r.flags&&4&r.wrap&&(r.check=fe(r.check,a,h,i)),s-=h,i+=h,x)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=16187;case 16187:if(4096&r.flags){if(0===s)break e;h=0;do{x=a[i+h++],r.head&&x&&r.length<65536&&(r.head.comment+=String.fromCharCode(x))}while(x&&h<s);if(512&r.flags&&4&r.wrap&&(r.check=fe(r.check,a,h,i)),s-=h,i+=h,x)break e}else r.head&&(r.head.comment=null);r.mode=16188;case 16188:if(512&r.flags){for(;f<16;){if(0===s)break e;s--,d+=a[i++]<<f,f+=8}if(4&r.wrap&&d!==(65535&r.check)){e.msg="header crc mismatch",r.mode=ir;break}d=0,f=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=$t;break;case 16189:for(;f<32;){if(0===s)break e;s--,d+=a[i++]<<f,f+=8}e.adler=r.check=or(d),d=0,f=0,r.mode=Xt;case Xt:if(0===r.havedict)return e.next_out=o,e.avail_out=l,e.next_in=i,e.avail_in=s,r.hold=d,r.bits=f,Ht;e.adler=r.check=1,r.mode=$t;case $t:if(t===Zt||t===jt)break e;case er:if(r.last){d>>>=7&f,f-=7&f,r.mode=nr;break}for(;f<3;){if(0===s)break e;s--,d+=a[i++]<<f,f+=8}switch(r.last=1&d,d>>>=1,f-=1,3&d){case 0:r.mode=16193;break;case 1:if(gr(r),r.mode=rr,t===jt){d>>>=2,f-=2;break e}break;case 2:r.mode=16196;break;case 3:e.msg="invalid block type",r.mode=ir}d>>>=2,f-=2;break;case 16193:for(d>>>=7&f,f-=7&f;f<32;){if(0===s)break e;s--,d+=a[i++]<<f,f+=8}if((65535&d)!=(d>>>16^65535)){e.msg="invalid stored block lengths",r.mode=ir;break}if(r.length=65535&d,d=0,f=0,r.mode=tr,t===jt)break e;case tr:r.mode=16195;case 16195:if(h=r.length,h){if(h>s&&(h=s),h>l&&(h=l),0===h)break e;n.set(a.subarray(i,i+h),o),s-=h,i+=h,l-=h,o+=h,r.length-=h;break}r.mode=$t;break;case 16196:for(;f<14;){if(0===s)break e;s--,d+=a[i++]<<f,f+=8}if(r.nlen=257+(31&d),d>>>=5,f-=5,r.ndist=1+(31&d),d>>>=5,f-=5,r.ncode=4+(15&d),d>>>=4,f-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=ir;break}r.have=0,r.mode=16197;case 16197:for(;r.have<r.ncode;){for(;f<3;){if(0===s)break e;s--,d+=a[i++]<<f,f+=8}r.lens[S[r.have++]]=7&d,d>>>=3,f-=3}for(;r.have<19;)r.lens[S[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,P={bits:r.lenbits},A=Mt(0,r.lens,0,19,r.lencode,0,r.work,P),r.lenbits=P.bits,A){e.msg="invalid code lengths set",r.mode=ir;break}r.have=0,r.mode=16198;case 16198:for(;r.have<r.nlen+r.ndist;){for(;k=r.lencode[d&(1<<r.lenbits)-1],g=k>>>24,_=k>>>16&255,w=65535&k,!(g<=f);){if(0===s)break e;s--,d+=a[i++]<<f,f+=8}if(w<16)d>>>=g,f-=g,r.lens[r.have++]=w;else{if(16===w){for(D=g+2;f<D;){if(0===s)break e;s--,d+=a[i++]<<f,f+=8}if(d>>>=g,f-=g,0===r.have){e.msg="invalid bit length repeat",r.mode=ir;break}x=r.lens[r.have-1],h=3+(3&d),d>>>=2,f-=2}else if(17===w){for(D=g+3;f<D;){if(0===s)break e;s--,d+=a[i++]<<f,f+=8}d>>>=g,f-=g,x=0,h=3+(7&d),d>>>=3,f-=3}else{for(D=g+7;f<D;){if(0===s)break e;s--,d+=a[i++]<<f,f+=8}d>>>=g,f-=g,x=0,h=11+(127&d),d>>>=7,f-=7}if(r.have+h>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=ir;break}for(;h--;)r.lens[r.have++]=x}}if(r.mode===ir)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=ir;break}if(r.lenbits=9,P={bits:r.lenbits},A=Mt(1,r.lens,0,r.nlen,r.lencode,0,r.work,P),r.lenbits=P.bits,A){e.msg="invalid literal/lengths set",r.mode=ir;break}if(r.distbits=6,r.distcode=r.distdyn,P={bits:r.distbits},A=Mt(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,P),r.distbits=P.bits,A){e.msg="invalid distances set",r.mode=ir;break}if(r.mode=rr,t===jt)break e;case rr:r.mode=ar;case ar:if(s>=6&&l>=258){e.next_out=o,e.avail_out=l,e.next_in=i,e.avail_in=s,r.hold=d,r.bits=f,Ft(e,u),o=e.next_out,n=e.output,l=e.avail_out,i=e.next_in,a=e.input,s=e.avail_in,d=r.hold,f=r.bits,r.mode===$t&&(r.back=-1);break}for(r.back=0;k=r.lencode[d&(1<<r.lenbits)-1],g=k>>>24,_=k>>>16&255,w=65535&k,!(g<=f);){if(0===s)break e;s--,d+=a[i++]<<f,f+=8}if(_&&!(240&_)){for(b=g,y=_,v=w;k=r.lencode[v+((d&(1<<b+y)-1)>>b)],g=k>>>24,_=k>>>16&255,w=65535&k,!(b+g<=f);){if(0===s)break e;s--,d+=a[i++]<<f,f+=8}d>>>=b,f-=b,r.back+=b}if(d>>>=g,f-=g,r.back+=g,r.length=w,0===_){r.mode=16205;break}if(32&_){r.back=-1,r.mode=$t;break}if(64&_){e.msg="invalid literal/length code",r.mode=ir;break}r.extra=15&_,r.mode=16201;case 16201:if(r.extra){for(D=r.extra;f<D;){if(0===s)break e;s--,d+=a[i++]<<f,f+=8}r.length+=d&(1<<r.extra)-1,d>>>=r.extra,f-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=16202;case 16202:for(;k=r.distcode[d&(1<<r.distbits)-1],g=k>>>24,_=k>>>16&255,w=65535&k,!(g<=f);){if(0===s)break e;s--,d+=a[i++]<<f,f+=8}if(!(240&_)){for(b=g,y=_,v=w;k=r.distcode[v+((d&(1<<b+y)-1)>>b)],g=k>>>24,_=k>>>16&255,w=65535&k,!(b+g<=f);){if(0===s)break e;s--,d+=a[i++]<<f,f+=8}d>>>=b,f-=b,r.back+=b}if(d>>>=g,f-=g,r.back+=g,64&_){e.msg="invalid distance code",r.mode=ir;break}r.offset=w,r.extra=15&_,r.mode=16203;case 16203:if(r.extra){for(D=r.extra;f<D;){if(0===s)break e;s--,d+=a[i++]<<f,f+=8}r.offset+=d&(1<<r.extra)-1,d>>>=r.extra,f-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=ir;break}r.mode=16204;case 16204:if(0===l)break e;if(h=u-l,r.offset>h){if(h=r.offset-h,h>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=ir;break}h>r.wnext?(h-=r.wnext,m=r.wsize-h):m=r.wnext-h,h>r.length&&(h=r.length),p=r.window}else p=n,m=o-r.offset,h=r.length;h>l&&(h=l),l-=h,r.length-=h;do{n[o++]=p[m++]}while(--h);0===r.length&&(r.mode=ar);break;case 16205:if(0===l)break e;n[o++]=r.length,l--,r.mode=ar;break;case nr:if(r.wrap){for(;f<32;){if(0===s)break e;s--,d|=a[i++]<<f,f+=8}if(u-=l,e.total_out+=u,r.total+=u,4&r.wrap&&u&&(e.adler=r.check=r.flags?fe(r.check,n,u,o-u):le(r.check,n,u,o-u)),u=l,4&r.wrap&&(r.flags?d:or(d))!==r.check){e.msg="incorrect data check",r.mode=ir;break}d=0,f=0}r.mode=16207;case 16207:if(r.wrap&&r.flags){for(;f<32;){if(0===s)break e;s--,d+=a[i++]<<f,f+=8}if(4&r.wrap&&d!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=ir;break}d=0,f=0}r.mode=16208;case 16208:A=Gt;break e;case ir:A=Jt;break e;case 16210:return Wt;default:return Yt}return e.next_out=o,e.avail_out=l,e.next_in=i,e.avail_in=s,r.hold=d,r.bits=f,(r.wsize||u!==e.avail_out&&r.mode<ir&&(r.mode<nr||t!==Nt))&&_r(e,e.output,e.next_out,u-e.avail_out),c-=e.avail_in,u-=e.avail_out,e.total_in+=c,e.total_out+=u,r.total+=u,4&r.wrap&&u&&(e.adler=r.check=r.flags?fe(r.check,n,u,e.next_out-u):le(r.check,n,u,e.next_out-u)),e.data_type=r.bits+(r.last?64:0)+(r.mode===$t?128:0)+(r.mode===rr||r.mode===tr?256:0),(0===c&&0===u||t===Nt)&&A===qt&&(A=Kt),A},inflateEnd:e=>{if(lr(e))return Yt;let t=e.state;return t.window&&(t.window=null),e.state=null,qt},inflateGetHeader:(e,t)=>{if(lr(e))return Yt;const r=e.state;return 2&r.wrap?(r.head=t,t.done=!1,qt):Yt},inflateSetDictionary:(e,t)=>{const r=t.length;let a,n,i;return lr(e)?Yt:(a=e.state,0!==a.wrap&&a.mode!==Xt?Yt:a.mode===Xt&&(n=1,n=le(n,t,r,0),n!==a.check)?Jt:(i=_r(e,t,r,r),i?(a.mode=16210,Wt):(a.havedict=1,qt)))},inflateInfo:"pako inflate (from Nodeca project)"};var br=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const yr=Object.prototype.toString,{Z_NO_FLUSH:vr,Z_FINISH:xr,Z_OK:Ar,Z_STREAM_END:kr,Z_NEED_DICT:Er,Z_STREAM_ERROR:Pr,Z_DATA_ERROR:Dr,Z_MEM_ERROR:Sr}=ue;function Or(e){this.options=ct({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new wt,this.strm.avail_out=0;let r=wr.inflateInit2(this.strm,t.windowBits);if(r!==Ar)throw new Error(ce[r]);if(this.header=new br,wr.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=pt(t.dictionary):"[object ArrayBuffer]"===yr.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=wr.inflateSetDictionary(this.strm,t.dictionary),r!==Ar)))throw new Error(ce[r])}function zr(e,t){const r=new Or(t);if(r.push(e),r.err)throw r.msg||ce[r.err];return r.result}Or.prototype.push=function(e,t){const r=this.strm,a=this.options.chunkSize,n=this.options.dictionary;let i,o,s;if(this.ended)return!1;for(o=t===~~t?t:!0===t?xr:vr,"[object ArrayBuffer]"===yr.call(e)?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){for(0===r.avail_out&&(r.output=new Uint8Array(a),r.next_out=0,r.avail_out=a),i=wr.inflate(r,o),i===Er&&n&&(i=wr.inflateSetDictionary(r,n),i===Ar?i=wr.inflate(r,o):i===Dr&&(i=Er));r.avail_in>0&&i===kr&&r.state.wrap>0&&0!==e[r.next_in];)wr.inflateReset(r),i=wr.inflate(r,o);switch(i){case Pr:case Dr:case Er:case Sr:return this.onEnd(i),this.ended=!0,!1}if(s=r.avail_out,r.next_out&&(0===r.avail_out||i===kr))if("string"===this.options.to){let e=_t(r.output,r.next_out),t=r.next_out-e,n=gt(r.output,e);r.next_out=t,r.avail_out=a-t,t&&r.output.set(r.output.subarray(e,e+t),0),this.onData(n)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(i!==Ar||0!==s){if(i===kr)return i=wr.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,!0;if(0===r.avail_in)break}}return!0},Or.prototype.onData=function(e){this.chunks.push(e)},Or.prototype.onEnd=function(e){e===Ar&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=ut(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Ur={Inflate:Or,inflate:zr,inflateRaw:function(e,t){return(t=t||{}).raw=!0,zr(e,t)},ungzip:zr};const{Deflate:Ir,deflate:Fr,deflateRaw:Br,gzip:Tr}=Ut,{Inflate:Rr,inflate:Cr,inflateRaw:Lr,ungzip:Mr}=Ur;var Nr={Deflate:Ir,deflate:Fr,deflateRaw:Br,gzip:Tr,Inflate:Rr,inflate:Cr,inflateRaw:Lr,ungzip:Mr,constants:ue},Zr=function(){return o(function e(t){n(this,e),s(this,"cache",void 0),s(this,"max",void 0),this.max=t,this.cache=new Map},[{key:"get",value:function(e){var t=this.cache.get(e);return t&&(this.cache.delete(e),this.cache.set(e,t)),t}},{key:"set",value:function(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size===this.max){var r=this.cache.keys().next().value;void 0!==r&&this.cache.delete(r)}this.cache.set(e,t)}}])}(),jr="1.2.840.10008.1.2",qr="1.2.840.10008.1.2.1",Gr="1.2.840.10008.1.2.1.99",Hr="1.2.840.10008.1.2.2",Yr="1.2.840.10008.1.2.5",Jr="1.2.840.10008.1.2.4.50",Wr="1.2.840.10008.1.2.4.51",Kr="1.2.840.10008.1.2.4.57",Vr="1.2.840.10008.1.2.4.70",Qr="1.2.840.10008.1.2.4.80",Xr="1.2.840.10008.1.2.4.81",$r="1.2.840.10008.1.2.4.90",ea="1.2.840.10008.1.2.4.91",ta="1.2.840.10008.1.2.4.201",ra="1.2.840.10008.1.2.4.202",aa="1.2.840.10008.1.2.4.203",na={Monochrome1:"MONOCHROME1",Monochrome2:"MONOCHROME2",PaletteColor:"PALETTE COLOR",Rgb:"RGB",YbrFull:"YBR_FULL",YbrFull422:"YBR_FULL_422",YbrPartial422:"YBR_PARTIAL_422",YbrPartial420:"YBR_PARTIAL_420",YbrIct:"YBR_ICT",YbrRct:"YBR_RCT",Cmyk:"CMYK",Argb:"ARGB",Hsv:"HSV"},ia=function(){return o(function e(){n(this,e)},null,[{key:"initialize",value:function(){var e=r(h().m(function e(t){var r,a,n,i,o,s,l,d=this;return h().w(function(e){for(;;)switch(e.n){case 0:return r={wasi_snapshot_preview1:{environ_get:function(e,t){return 0},environ_sizes_get:function(e,t){return 0},fd_write:function(e,t,r,a){return 0},fd_seek:function(e,t,r,a){return 0},fd_close:function(e){return 0},proc_exit:function(e){throw new Error("WebAssembly module exited with return value ".concat(e))}},env:{emscripten_notify_memory_growth:function(e){},onCodecsInfo:function(e,t){},onCodecsTrace:function(e,t){},onCodecsException:function(e,t){var r=d._wasmToJsString(e,t);throw new Error(r)}}},e.n=1,fetch(this._wasmFilename);case 1:return a=e.v,e.n=2,WebAssembly.instantiateStreaming(a,r);case 2:n=e.v,i=n.instance,o=n.module,s=WebAssembly.Module.exports(o),l=s.filter(function(e){return"function"===e.kind}),this._frameDecoderApi={wasmInstance:i,wasmModule:o,wasmMemory:i.exports.memory,functions:{}},l.forEach(function(e){var t="wasm".concat(e.name);d._frameDecoderApi.functions[t]=i.exports[e.name]});case 3:return e.a(2)}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"isInitialized",value:function(){return!!this._frameDecoderApi}},{key:"decodeFrameData",value:function(e,t){if(!t.encodedBuffer)throw new Error("No encoded buffer provided");var r=void 0;switch(e){case jr:case qr:case Gr:(r=u({},t)).decodedBuffer=t.encodedBuffer;break;case Hr:if((r=u({},t)).decodedBuffer=new Uint8Array(t.encodedBuffer),t.bitsAllocated>8&&t.bitsAllocated<=16)for(var a=0;a<r.decodedBuffer.length;a+=2){var n=r.decodedBuffer[a];r.decodedBuffer[a]=r.decodedBuffer[a+1],r.decodedBuffer[a+1]=n}break;case Yr:r=this._decodeRle(t);break;case Jr:case Wr:r=this._decodeJpeg(t,{convertColorspaceToRgb:!0});break;case Kr:case Vr:r=this._decodeJpeg(t);break;case Qr:case Xr:r=this._decodeJpegLs(t);break;case $r:case ea:case ta:case ra:case aa:r=this._decodeJpeg2000(t),t.photometricInterpretation!==na.YbrRct&&t.photometricInterpretation!==na.YbrIct||(r.photometricInterpretation=na.Rgb);break;default:throw new Error("Unsupported transfer syntax UID: ".concat(e))}if(!r)throw new Error("Failed to decode frame data");return{width:r.width,height:r.height,bitsAllocated:r.bitsAllocated,bitsStored:r.bitsStored,samplesPerPixel:r.samplesPerPixel,pixelRepresentation:r.pixelRepresentation,planarConfiguration:r.planarConfiguration,photometricInterpretation:r.photometricInterpretation,decodedBuffer:r.decodedBuffer}}},{key:"_decodeRle",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this._frameDecoderApi)throw new Error("WebAssembly module is not initialized");var r=this._createDecoderContext(e),a=this._createDecoderParameters(t);return this._frameDecoderApi.functions.wasmDecodeRle(r,a),this._releaseDecoderParameters(a),this._releaseDecoderContext(r)}},{key:"_decodeJpeg",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this._frameDecoderApi)throw new Error("WebAssembly module is not initialized");var r=this._createDecoderContext(e),a=this._createDecoderParameters(t);return this._frameDecoderApi.functions.wasmDecodeJpeg(r,a),this._releaseDecoderParameters(a),this._releaseDecoderContext(r)}},{key:"_decodeJpegLs",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this._frameDecoderApi)throw new Error("WebAssembly module is not initialized");var r=this._createDecoderContext(e),a=this._createDecoderParameters(t);return this._frameDecoderApi.functions.wasmDecodeJpegLs(r,a),this._releaseDecoderParameters(a),this._releaseDecoderContext(r)}},{key:"_decodeJpeg2000",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this._frameDecoderApi)throw new Error("WebAssembly module is not initialized");var r=this._createDecoderContext(e),a=this._createDecoderParameters(t);return this._frameDecoderApi.functions.wasmDecodeJpeg2000(r,a),this._releaseDecoderParameters(a),this._releaseDecoderContext(r)}},{key:"_createDecoderContext",value:function(e){if(!this._frameDecoderApi)throw new Error("WebAssembly module is not initialized");var t=this._frameDecoderApi.functions.wasmCreateCodecsContext();this._frameDecoderApi.functions.wasmSetColumns(t,e.width),this._frameDecoderApi.functions.wasmSetRows(t,e.height),this._frameDecoderApi.functions.wasmSetBitsAllocated(t,e.bitsAllocated),this._frameDecoderApi.functions.wasmSetBitsStored(t,e.bitsStored),this._frameDecoderApi.functions.wasmSetSamplesPerPixel(t,e.samplesPerPixel),this._frameDecoderApi.functions.wasmSetPixelRepresentation(t,e.pixelRepresentation),this._frameDecoderApi.functions.wasmSetPlanarConfiguration(t,e.planarConfiguration),this._frameDecoderApi.functions.wasmSetPhotometricInterpretation(t,Object.values(na).indexOf(e.photometricInterpretation));var r=e.encodedBuffer;if(r){this._frameDecoderApi.functions.wasmSetEncodedBufferSize(t,r.length);var a=this._frameDecoderApi.functions.wasmGetEncodedBuffer(t);new Uint8Array(this._frameDecoderApi.wasmMemory.buffer).set(r,a)}return t}},{key:"_releaseDecoderContext",value:function(e){if(!this._frameDecoderApi)throw new Error("WebAssembly module is not initialized");var t=this._frameDecoderApi.functions.wasmGetDecodedBuffer(e),r=this._frameDecoderApi.functions.wasmGetDecodedBufferSize(e),a=new Uint8Array(this._frameDecoderApi.wasmMemory.buffer),n=new Uint8Array(a.buffer,t,r).slice(0),i={width:this._frameDecoderApi.functions.wasmGetColumns(e),height:this._frameDecoderApi.functions.wasmGetRows(e),bitsAllocated:this._frameDecoderApi.functions.wasmGetBitsAllocated(e),bitsStored:this._frameDecoderApi.functions.wasmGetBitsStored(e),samplesPerPixel:this._frameDecoderApi.functions.wasmGetSamplesPerPixel(e),pixelRepresentation:this._frameDecoderApi.functions.wasmGetPixelRepresentation(e),planarConfiguration:this._frameDecoderApi.functions.wasmGetPlanarConfiguration(e),photometricInterpretation:Object.values(na)[this._frameDecoderApi.functions.wasmGetPhotometricInterpretation(e)],decodedBuffer:n};return this._frameDecoderApi.functions.wasmReleaseCodecsContext(e),i}},{key:"_createDecoderParameters",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this._frameDecoderApi)throw new Error("WebAssembly module is not initialized");var t=this._frameDecoderApi.functions.wasmCreateDecoderParameters();return this._frameDecoderApi.functions.wasmSetConvertColorspaceToRgb(t,e.convertColorspaceToRgb||!1),t}},{key:"_releaseDecoderParameters",value:function(e){if(!this._frameDecoderApi)throw new Error("WebAssembly module is not initialized");this._frameDecoderApi.functions.wasmReleaseDecoderParameters(e)}},{key:"_wasmToJsString",value:function(e,t){if(!this._frameDecoderApi)throw new Error("WebAssembly module is not initialized");for(var r=new Uint8Array(this._frameDecoderApi.wasmMemory.buffer),a=new Uint8Array(r.buffer,e,t),n="",i=0;i<t;i++)n+=String.fromCharCode(a[i]);return n}}])}();s(ia,"_frameDecoderApi",void 0),s(ia,"_wasmFilename","dcmjs-native-codecs.wasm");var oa=function(){return o(function e(){n(this,e)},[{key:"initialize",value:function(e){throw new Error("initialize should be implemented")}},{key:"render",value:function(){var e=r(h().m(function e(t,r){return h().w(function(e){for(;;)switch(e.n){case 0:throw new Error("render should be implemented");case 1:return e.a(2)}},e)}));return function(t,r){return e.apply(this,arguments)}}()}],[{key:"create",value:function(e,t){if(!t.photometricInterpretation)throw new Error("Photometric interpretation is required to construct a rendering pipeline");var r=this.pipelineCache.get(t.photometricInterpretation);if(void 0!==r)return r;if("MONOCHROME1"===t.photometricInterpretation||"MONOCHROME2"===t.photometricInterpretation){var a=new sa;return a.initialize(e),this.pipelineCache.set(t.photometricInterpretation,a),a}if("RGB"===t.photometricInterpretation){var n=new la;return n.initialize(e),this.pipelineCache.set(t.photometricInterpretation,n),n}throw new Error("Unsupported photometric interpretation: ".concat(t.photometricInterpretation))}}])}();s(oa,"pipelineCache",new Zr(5));var sa=function(e){function t(){var e;n(this,t);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return s(e=a(this,t,[].concat(i)),"device",void 0),s(e,"computePipeline",void 0),s(e,"bindGroupLayout",void 0),e}return d(t,e),o(t,[{key:"initialize",value:function(e){var t=e.createShaderModule({label:"Grayscale shader module",code:"\nstruct Dimensions {\n    columns: u32,\n    rows: u32\n}\n\nstruct Scale {\n    slope: f32,\n    intercept: f32\n}\n\nstruct Window {\n    centerMin05: f32,\n    widthMin1: f32\n}\n\nstruct Lut {\n    reserved: u32,\n    invert: u32\n}\n\nstruct ImageFrame {\n    dimensions: Dimensions,\n    scaling: Scale,\n    window: Window,\n    lut: Lut,\n    pixelData: array<f32>\n}\n\n@group(0) @binding(0) var <storage, read> imageFrame: ImageFrame;\n@group(0) @binding(1) var <storage, read_write> renderedPixelData: array<vec4<u32>>;\n\n@compute @workgroup_size(16, 16)\nfn main(\n    @builtin(global_invocation_id) global_id: vec3<u32>\n) {\n    if (global_id.x > imageFrame.dimensions.columns || global_id.y > imageFrame.dimensions.rows) {\n        return;\n    }\n\n    // Current index\n    let idx: u32 = imageFrame.dimensions.columns * global_id.y + global_id.x;\n\n    // Apply rescale LUT\n    let s: f32 = imageFrame.pixelData[idx] * imageFrame.scaling.slope + imageFrame.scaling.intercept;\n\n    // Apply VOI LUT\n    let v: f32 = (((s - imageFrame.window.centerMin05) / imageFrame.window.widthMin1 + 0.5) * 255.0);\n\n    // Clamp to [0, 255]\n    let c: u32 = u32(clamp(v, 0.0, 255.0));\n\n    // Invert if needed\n    let r: u32 = select(c, 255u - c, imageFrame.lut.invert > 0u);\n\n    // Write the result\n    renderedPixelData[idx] = vec4<u32>(r, r, r, 255u);\n}\n".replace(/\n\s*\n/g,"\n").replace(/\/\*[\s\S]*?\*\/|(?<=[^:])\/\/.*|^\/\/.*/g,"")}),r=e.createBindGroupLayout({label:"Grayscale bind group layout",entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage"}},{binding:1,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}}]}),a=e.createPipelineLayout({bindGroupLayouts:[r]}),n=e.createComputePipeline({label:"Grayscale compute pipeline",layout:a,compute:{module:t,entryPoint:"main"}});this.device=e,this.bindGroupLayout=r,this.computePipeline=n}},{key:"render",value:(i=r(h().m(function e(t,r){var a,n,i,o,s,l,d,f,c,u,m,p,g,_,w,b,y,v,x,A,k,E,P,D;return h().w(function(e){for(;;)switch(e.n){case 0:if(void 0!==this.device&&void 0!==this.computePipeline&&void 0!==this.bindGroupLayout){e.n=1;break}throw new Error("Pipeline is not initialized");case 1:return a=t.rows,n=t.columns,i=t.rescaleSlope,o=t.rescaleIntercept,s=t.windowCenter,l=t.windowWidth,d=t.pixelData,f=t.photometricInterpretation,c="MONOCHROME1"===f?1:0,m=4*(u=a*n*4),p=u+32,g=16*Math.ceil(p/16),_=this.device.createBuffer({label:"Image frame buffer input",size:g,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST}),w=this.device.createBuffer({label:"Pixel data buffer output",size:4*p,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC}),b=this.device.createBuffer({label:"Pixel data staging buffer",size:m,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST}),y=this.device.createBindGroup({label:"Grayscale bind group",layout:this.bindGroupLayout,entries:[{binding:0,resource:{buffer:_}},{binding:1,resource:{buffer:w}}]}),this.device.queue.writeBuffer(_,0,new Int32Array([n,a])),this.device.queue.writeBuffer(_,8,new Float32Array([i,o])),this.device.queue.writeBuffer(_,16,new Float32Array([s-.5,l-1])),this.device.queue.writeBuffer(_,24,new Float32Array([0,c])),v=d,(x=new Float32Array(v.length)).set(v),this.device.queue.writeBuffer(_,32,x),A=this.device.createCommandEncoder({label:"Grayscale encoder"}),(k=A.beginComputePass({label:"Grayscale compute pass"})).setPipeline(this.computePipeline),k.setBindGroup(0,y),k.dispatchWorkgroups(Math.ceil(n/16),Math.ceil(a/16)),k.end(),A.copyBufferToBuffer(w,0,b,0,m),E=A.finish(),this.device.queue.submit([E]),e.n=2,b.mapAsync(GPUMapMode.READ,0,m);case 2:return P=new Uint32Array(b.getMappedRange(0,m).slice()),b.unmap(),b.destroy(),_.destroy(),w.destroy(),(D=new Uint8Array(4*a*n)).set(P),e.a(2,{pixelData:D,width:n,height:a})}},e,this)})),function(e,t){return i.apply(this,arguments)})}]);var i}(oa),la=function(e){function t(){return n(this,t),a(this,t,arguments)}return d(t,e),o(t,[{key:"initialize",value:function(e){}},{key:"render",value:(i=r(h().m(function e(t,r){var a,n,i,o,s,l,d,f;return h().w(function(e){for(;;)if(0===e.n){for(a=t.rows,n=t.columns,i=t.pixelData,o=t.planarConfiguration,s=1===o,l=new Uint8Array(4*a*n),d=0,f=0;d<a*n;d++,f+=4)l[f]=s?i[d]:i[3*d],l[f+1]=s?i[d+a*n]:i[3*d+1],l[f+2]=s?i[d+2*a*n]:i[3*d+2],l[f+3]=255;return e.a(2,{pixelData:l,width:n,height:a})}},e)})),function(e,t){return i.apply(this,arguments)})}]);var i}(oa);function da(e,t,r){if(!e)throw new Error("Dataset is required");var a=e.string(t);if(a){var n=a.split("\\");if(!(n.length<r))return n.map(function(e){return parseFloat(e)})}}var fa=new Zr(3);function ca(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=e.elements.x7fe00010||e.elements.x7fe00008;if(!r)throw new Error("Pixel data element was not found");return r.encapsulatedPixelData?function(e){var t,r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(null!==(t=e.elements.x7fe00010)&&void 0!==t&&null!==(t=t.basicOffsetTable)&&void 0!==t&&t.length)return A.readEncapsulatedImageFrame(e,e.elements.x7fe00010,a);var n=e.intString("x00280008"),i=e.elements.x7fe00010,o=i&&n!==(null===(r=i.fragments)||void 0===r?void 0:r.length);if(o){var s=A.createJPEGBasicOffsetTable(e,i);return A.readEncapsulatedImageFrame(e,i,a,s)}return A.readEncapsulatedPixelDataFromFragments(e,i,a)}(e,t):function(e,t){var r=e.elements.x7fe00010||e.elements.x7fe00008,a=e.uint16("x00280100"),n=e.uint16("x00280010"),i=e.uint16("x00280011"),o=e.uint16("x00280002");if(!r)throw new Error("Pixel data element is missing");if(!(a&&n&&i&&o))throw new Error("Missing required attributes [allocated: ".concat(a,", rows: ").concat(n,", columns: ").concat(i,", samples: ").concat(o,"]"));var s=r.dataOffset,l=n*i*o;if(8===a){var d=s+t*l;if(d>=e.byteArray.length)throw new Error("Frame exceeds size of pixel data");return new Uint8Array(e.byteArray.buffer.slice(d,d+l))}if(16===a){var f=s+t*l*2;if(f>=e.byteArray.length)throw new Error("Frame exceeds size of pixel data");return new Uint8Array(e.byteArray.buffer.slice(f,f+2*l))}throw new Error("Unsupported pixel format [Bits allocated: ".concat(a,"]"))}(e,t)}function ua(){return(ua=r(h().m(function e(t){return h().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,ia.initialize(t);case 1:return e.a(2)}},e)}))).apply(this,arguments)}function ha(){return(ha=r(h().m(function e(t,r,a){var n,i,o,s;return h().w(function(e){for(;;)switch(e.n){case 0:if(t){e.n=1;break}throw new Error("GPU device is required");case 1:if(r){e.n=2;break}throw new Error("DICOM data buffer is required");case 2:return n=void 0,i=!1,a&&a.cacheKey&&(n=fa.get(a.cacheKey)),n||(n=ma(r,a),i=!0),a&&a.cacheKey&&i&&fa.set(a.cacheKey,n),o=oa.create(t,n),e.n=3,o.render(n,a);case 3:return s=e.v,e.a(2,s)}},e)}))).apply(this,arguments)}function ma(e,t){t=t||{};var r=A.parseDicom(e,{inflater:function(t,r){var a=t.slice(r),n=Nr.inflateRaw(a),i=new Uint8Array(n.length+r);return i.set(e.slice(0,r),0),i.set(n,r),i}});if(!r)throw new Error("Failed to parse DICOM data");var a=r.string("x00020010");if(!a)throw new Error("Transfer syntax UID is missing");var n=ca(r,t.frameIndex||0);if(!n)throw new Error("Pixel data is missing");var i=r.uint16("x00280010"),o=r.uint16("x00280011");if(!i||!o)throw new Error("Rows and columns are required");var s=r.uint16("x00280100")||0,l=r.uint16("x00280101")||s;if(8!==s&&16!==s)throw new Error("Invalid bits allocated value [bits: ".concat(s,"]"));var d=r.uint16("x00280103")||0,f=r.uint16("x00280102")||l-1,c=r.uint16("x00280002")||1,u=r.string("x00280004")||"",h=r.uint16("x00280006")||0;if(!ia.isInitialized())throw new Error("Frame decoder is not initialized");var m=ia.decodeFrameData(a,{width:o,height:i,bitsAllocated:s,bitsStored:l,samplesPerPixel:c,pixelRepresentation:d,planarConfiguration:h,photometricInterpretation:u,encodedBuffer:n});if(!m||!m.decodedBuffer)throw new Error("Failed to decode pixel data");m.photometricInterpretation&&(u=m.photometricInterpretation);var p=function(e,t,r,a,n){var i;if(8===a&&7===n&&8===r)i=e;else{if(!(r<=16))throw new Error("Unsupported pixel data value for bits stored: ".concat(a));if(0===t)i=new Uint16Array(e.buffer,e.byteOffset,e.byteLength/Uint16Array.BYTES_PER_ELEMENT);else{var o=new Uint16Array(e.buffer,e.byteOffset,e.byteLength/Uint16Array.BYTES_PER_ELEMENT);i=new Int16Array(o)}}return i}(m.decodedBuffer,d,s,l,f),g=function(e){for(var t=e[0],r=t,a=0;a<e.length;a++){var n=e[a];n<t?t=n:n>r&&(r=n)}return{minPixelValue:t,maxPixelValue:r}}(p),_=g.minPixelValue,w=g.maxPixelValue,b=r.floatString("x00281052")||0,y=r.floatString("x00281053")||1,v=da(r,"x00281050",1),x=Array.isArray(v)?v[0]:v,k=da(r,"x00281051",1),E=Array.isArray(k)?k[0]:k;if(void 0===x||void 0===E){var P=w*y+b,D=_*y+b;E=P-D,x=(P+D)/2}return{samplesPerPixel:c,photometricInterpretation:u,planarConfiguration:h,rows:i,columns:o,bitsAllocated:s,bitsStored:l,highBit:f,rescaleIntercept:b,rescaleSlope:y,pixelRepresentation:d,minPixelValue:_,maxPixelValue:w,windowCenter:x,windowWidth:E,pixelData:p}}e.initialize=function(e){return ua.apply(this,arguments)},e.render=function(e,t,r){return ha.apply(this,arguments)},e.version="0.0.5"});
//# sourceMappingURL=dicom-imaging-webgpu.js.map
